This file is a merged representation of a subset of the codebase, containing specifically included files, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of a subset of the repository's contents that is considered the most important context.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Only files matching these patterns are included: **/*.vue, **/*.js, **/*.html, **/*.json
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
index.html
package.json
public/galaxy-data.json
scripts/generate-graph.js
scripts/generate-rss.js
scripts/sync-knowledge.js
src/App.vue
src/components/Galaxy3D.vue
src/components/GalaxyBottomSheet.vue
src/components/HelloWorld.vue
src/components/TheAiAssistant.vue
src/components/TheRightBar.vue
src/components/TheSidebar.vue
src/composables/useMarkdown.js
src/composables/useScrollAnimations.js
src/config/ai.js
src/layouts/MainLayout.vue
src/main.js
src/router/index.js
src/stores/app.js
src/utils/markdown.js
src/views/Blog.vue
src/views/BlogDetail.vue
src/views/Contact.vue
src/views/Friends.vue
src/views/GalaxyPage.vue
src/views/Home.vue
src/views/Portfolio.vue
src/views/PortfolioDetail.vue
vite.config.js
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="index.html">
<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color" content="#DBA91C">
  <link rel="shortcut icon" href="/src/assets/img-dark/ui/favicon.png" type="image/x-icon">
  <title>Wasker</title>
</head>

<body>
  <div id="app"></div>
  <script type="module" src="/src/main.js"></script>
</body>

</html>
</file>

<file path="public/galaxy-data.json">
{
  "nodes": [
    {
      "id": "profile/profile",
      "slug": "profile",
      "type": "profile",
      "name": "profile/profile",
      "category": "Uncategorized",
      "val": 1,
      "desc": "",
      "filePath": "profile/profile.md"
    },
    {
      "id": "portfolio/brand-identity",
      "slug": "brand-identity",
      "type": "portfolio",
      "name": "Modern Brand Identity",
      "category": "Branding",
      "val": 1,
      "desc": "A complete rebranding for a tech startup.",
      "filePath": "portfolio/brand-identity.md"
    },
    {
      "id": "friend/vuejs",
      "slug": "vuejs",
      "type": "friend",
      "name": "friend/vuejs",
      "category": "Uncategorized",
      "val": 1,
      "desc": "The Progressive JavaScript Framework.",
      "filePath": "friend/vuejs.md"
    },
    {
      "id": "friend/vite",
      "slug": "vite",
      "type": "friend",
      "name": "friend/vite",
      "category": "Uncategorized",
      "val": 1,
      "desc": "Next Generation Frontend Tooling.",
      "filePath": "friend/vite.md"
    },
    {
      "id": "blog/ui-ux-guide",
      "slug": "ui-ux-guide",
      "type": "blog",
      "name": "The Ultimate Guide to UI/UX Design",
      "category": "UI/UX",
      "val": 2,
      "desc": "Detailed guide on UI/UX best practices.",
      "filePath": "blog/ui-ux-guide.md"
    },
    {
      "id": "blog/typography-guide",
      "slug": "typography-guide",
      "type": "blog",
      "name": "Typography Essentials",
      "category": "Design",
      "val": 1,
      "desc": "Choosing the right fonts.",
      "filePath": "blog/typography-guide.md"
    },
    {
      "id": "blog/table-examples",
      "slug": "table-examples",
      "type": "blog",
      "name": "Working with Tables",
      "category": "Data",
      "val": 1,
      "desc": "Displaying tabular data.",
      "filePath": "blog/table-examples.md"
    },
    {
      "id": "blog/python-data-science",
      "slug": "python-data-science",
      "type": "blog",
      "name": "Python for Data Science",
      "category": "Data",
      "val": 1,
      "desc": "Using Pandas and NumPy for data analysis.",
      "filePath": "blog/python-data-science.md"
    },
    {
      "id": "blog/mixed-content",
      "slug": "mixed-content",
      "type": "blog",
      "name": "The Kitchen Sink",
      "category": "Misc",
      "val": 1,
      "desc": "A little bit of everything in one post.",
      "filePath": "blog/mixed-content.md"
    },
    {
      "id": "blog/markdown-syntax-guide",
      "slug": "markdown-syntax-guide",
      "type": "blog",
      "name": "Markdown Syntax Master Guide",
      "category": "Code",
      "val": 1,
      "desc": "A comprehensive test of standard Markdown syntax elements.",
      "filePath": "blog/markdown-syntax-guide.md"
    },
    {
      "id": "blog/javascript-tutorial",
      "slug": "javascript-tutorial",
      "type": "blog",
      "name": "Modern JavaScript Features",
      "category": "Code",
      "val": 2,
      "desc": "Exploring ES6+ features with code examples.",
      "filePath": "blog/javascript-tutorial.md"
    },
    {
      "id": "blog/html5-features",
      "slug": "html5-features",
      "type": "blog",
      "name": "Semantic HTML5",
      "category": "Code",
      "val": 1,
      "desc": "writing accessible and semantic markup.",
      "filePath": "blog/html5-features.md"
    },
    {
      "id": "blog/graphic-designer",
      "slug": "graphic-designer",
      "type": "blog",
      "name": "How to Become a Graphic Designer in 10 Simple Steps",
      "category": "Design",
      "val": 2,
      "desc": "Repellendus minima repellat fuga tempora impedit alias dolores odit id, placeat ut officia dicta.",
      "filePath": "blog/graphic-designer.md"
    },
    {
      "id": "blog/design-principles",
      "slug": "design-principles",
      "type": "blog",
      "name": "Minimalist Design Principles",
      "category": "Design",
      "val": 2,
      "desc": "Less is more.",
      "filePath": "blog/design-principles.md"
    },
    {
      "id": "blog/css-tricks",
      "slug": "css-tricks",
      "type": "blog",
      "name": "Advanced CSS Layouts",
      "category": "Design",
      "val": 1,
      "desc": "Mastering Flexbox and Grid.",
      "filePath": "blog/css-tricks.md"
    },
    {
      "id": "blog/test/link-test",
      "slug": "link-test",
      "type": "blog",
      "name": "Internal Link Demo",
      "category": "Test",
      "val": 1,
      "desc": "Demonstrating how to link between markdown files.",
      "filePath": "blog/test/link-test.md"
    },
    {
      "id": "blog/test/code-blocks-demo",
      "slug": "code-blocks-demo",
      "type": "blog",
      "name": "Deep Dive into Code Blocks",
      "category": "Uncategorized",
      "val": 1,
      "desc": "Testing various programming languages in markdown code blocks.",
      "filePath": "blog/test/code-blocks-demo.md"
    },
    {
      "id": "blog/Demo/threejs-basics",
      "slug": "threejs-basics",
      "type": "blog",
      "name": "Three.js Basics for Data Viz",
      "category": "Demo",
      "val": 2,
      "desc": "Simple starters for 3D web graphics.",
      "filePath": "blog/Demo/threejs-basics.md"
    },
    {
      "id": "blog/Demo/galaxy-visual-style",
      "slug": "galaxy-visual-style",
      "type": "blog",
      "name": "Defining the Visual Style",
      "category": "Demo",
      "val": 2,
      "desc": "Aesthetic choices for the Knowledge Galaxy.",
      "filePath": "blog/Demo/galaxy-visual-style.md"
    },
    {
      "id": "blog/Demo/galaxy-tech-stack",
      "slug": "galaxy-tech-stack",
      "type": "blog",
      "name": "The Tech Stack Behind the Galaxy",
      "category": "Demo",
      "val": 3,
      "desc": "How we use Three.js and Vue 3 to build a performant 3D graph.",
      "filePath": "blog/Demo/galaxy-tech-stack.md"
    },
    {
      "id": "blog/Demo/galaxy-introduction",
      "slug": "galaxy-introduction",
      "type": "blog",
      "name": "Introduction to Knowledge Galaxy",
      "category": "Demo",
      "val": 3,
      "desc": "Exploring the concept of a 3D knowledge graph for local markdown content.",
      "filePath": "blog/Demo/galaxy-introduction.md"
    }
  ],
  "links": [
    {
      "source": "blog/test/link-test",
      "target": "blog/graphic-designer"
    },
    {
      "source": "blog/test/link-test",
      "target": "blog/ui-ux-guide"
    },
    {
      "source": "blog/test/link-test",
      "target": "blog/javascript-tutorial"
    },
    {
      "source": "blog/Demo/threejs-basics",
      "target": "blog/Demo/galaxy-tech-stack"
    },
    {
      "source": "blog/Demo/galaxy-visual-style",
      "target": "blog/Demo/galaxy-introduction"
    },
    {
      "source": "blog/Demo/galaxy-visual-style",
      "target": "blog/design-principles"
    },
    {
      "source": "blog/Demo/galaxy-tech-stack",
      "target": "blog/Demo/galaxy-introduction"
    },
    {
      "source": "blog/Demo/galaxy-tech-stack",
      "target": "blog/Demo/threejs-basics"
    },
    {
      "source": "blog/Demo/galaxy-introduction",
      "target": "blog/Demo/galaxy-tech-stack"
    },
    {
      "source": "blog/Demo/galaxy-introduction",
      "target": "blog/Demo/galaxy-visual-style"
    }
  ]
}
</file>

<file path="scripts/generate-graph.js">
import fs from 'fs';
import path from 'path';
import { glob } from 'glob';
import matter from 'gray-matter';

const contentDir = path.resolve('src/content');
const outputFile = path.resolve('public/galaxy-data.json');

async function generateGraph() {
    console.log('Generating knowledge graph...');

    const files = await glob(`${contentDir}/**/*.md`);
    const nodes = [];
    const links = [];
    const idMap = new Map(); // Map file path to node ID

    // 1. First pass: Create nodes
    files.forEach((file) => {
        const content = fs.readFileSync(file, 'utf-8');
        const { data } = matter(content);

        // Use relative path as ID to match links
        const relativePath = path.relative(contentDir, file).replace(/\\/g, '/');
        const id = relativePath.replace(/\.md$/, ''); // Remove extension for cleaner IDs

        const pathParts = id.split('/');
        const type = pathParts[0];
        const slug = pathParts[pathParts.length - 1];

        idMap.set(relativePath, id);

        nodes.push({
            id: id,
            slug: slug,
            type: type,
            name: data.title || id,
            category: data.category || 'Uncategorized',
            val: 1, // Base weight, will increment based on citations
            desc: data.description || '', // For bottom sheet
            filePath: relativePath // Store for linking
        });
    });

    // 2. Second pass: Create links and calculate weights
    files.forEach((file) => {
        const content = fs.readFileSync(file, 'utf-8');
        // Regex for [[Wiki Link]]
        const wikiLinkRegex = /\[\[(.*?)\]\]/g;
        // Regex for standard markdown link [Label](./path/to/file.md)
        const mdLinkRegex = /\[.*?\]\((.*?)\)/g;

        const sourcePath = path.relative(contentDir, file).replace(/\\/g, '/');
        const sourceId = idMap.get(sourcePath);

        if (!sourceId) return;

        // Process Wiki Links
        let match;
        while ((match = wikiLinkRegex.exec(content)) !== null) {
            const targetTitle = match[1];
            // Find target node by title, ID, or slug
            const targetNode = nodes.find(n =>
                n.name === targetTitle ||
                n.id === targetTitle ||
                n.slug === targetTitle
            );

            if (targetNode && targetNode.id !== sourceId) {
                links.push({
                    source: sourceId,
                    target: targetNode.id
                });
                targetNode.val += 1; // Increase target weight
            }
        }

        // Process Standard Links
        while ((match = mdLinkRegex.exec(content)) !== null) {
            let linkPath = match[1];
            let targetNode = null;

            // 1. Handle relative paths (e.g., ./post.md, ../other/post.md)
            if (linkPath.startsWith('./') || linkPath.startsWith('../')) {
                const absoluteLinkPath = path.resolve(path.dirname(file), linkPath);
                const relativeLinkPath = path.relative(contentDir, absoluteLinkPath).replace(/\\/g, '/');
                const targetId = idMap.get(relativeLinkPath);
                if (targetId) {
                    targetNode = nodes.find(n => n.id === targetId);
                }
            }
            // 2. Handle absolute-style paths (e.g., /blog/slug, /portfolio/slug)
            else if (linkPath.startsWith('/')) {
                const parts = linkPath.split('/').filter(Boolean); // ["blog", "slug"]
                if (parts.length >= 2) {
                    const type = parts[0];
                    const slug = parts[parts.length - 1];
                    targetNode = nodes.find(n => n.type === type && n.slug === slug);
                }
            }

            if (targetNode && targetNode.id !== sourceId) {
                links.push({
                    source: sourceId,
                    target: targetNode.id
                });
                targetNode.val += 1;
            }
        }
    });

    // 3. Finalize data
    const graphData = {
        nodes: nodes,
        links: links
    };

    fs.writeFileSync(outputFile, JSON.stringify(graphData, null, 2));
    console.log(`Graph data generated with ${nodes.length} nodes and ${links.length} links.`);
}

generateGraph().catch(console.error);
</file>

<file path="scripts/sync-knowledge.js">
/**
 * sync-knowledge.js
 * 
 * Syncs markdown files from src/content/blog to Coze Knowledge Base.
 * Supports both CN and Global platforms.
 * 
 * Logic:
 * 1. Identify changed files (using git diff if available, or scan all).
 * 2. Read content and front-matter.
 * 3. Upload to Coze CN and Coze Global.
 * 4. Handle rate limits.
 */

import 'dotenv/config';
import fs from 'fs';
import path from 'path';
import crypto from 'crypto';
import { execSync } from 'child_process';
import { glob } from 'glob';

// Environment variables
const COZE_CN_TOKEN = process.env.COZE_CN_TOKEN;
const COZE_GLOBAL_TOKEN = process.env.COZE_GLOBAL_TOKEN;
// Note: Dataset IDs should optimally be in env or arguments. 
// Assuming a simplified flow where we might create/update a dataset or just upload to a bot's knowledge.
// For this script, we'll assume we are uploading to a specific Dataset ID if provided, 
// or just logging the meaningful API interaction part.
const COZE_CN_DATASET_ID = process.env.COZE_CN_DATASET_ID;
const COZE_GLOBAL_DATASET_ID = process.env.COZE_GLOBAL_DATASET_ID;

const BLOG_DIR = 'src/content/blog';

// API Endpoints
const API_CN = 'https://api.coze.cn/open_api/v1/datasets/document/update'; // Placeholder specific endpoint
const API_GLOBAL = 'https://api.coze.com/open_api/v1/datasets/document/update';

if (!COZE_CN_TOKEN && !COZE_GLOBAL_TOKEN) {
    console.warn('‚ö†Ô∏è  No Coze tokens found (COZE_CN_TOKEN, COZE_GLOBAL_TOKEN). Skipping sync.');
    process.exit(0);
}

/**
 * Get list of changed files using git.
 * Falls back to all files if git check fails or returns empty (e.g. initial run).
 */
function getChangedFiles() {
    try {
        // Check for changes in the last commit (HEAD) targeting the blog directory
        const output = execSync(`git diff --name-only HEAD~1 HEAD ${BLOG_DIR}`).toString();
        const files = output.split('\n').filter(line => line.trim().endsWith('.md'));
        if (files.length > 0) {
            console.log(`üìù Detected ${files.length} changed files via git.`);
            return files;
        }
    } catch (e) {
        console.log('‚ö†Ô∏è  Git diff failed or not applicable, scanning all files...');
    }

    // Fallback: finding all md files
    return glob.sync(`${BLOG_DIR}/**/*.md`);
}

async function uploadToCoze(filePath, content, region) {
    const token = region === 'CN' ? COZE_CN_TOKEN : COZE_GLOBAL_TOKEN;
    const datasetId = region === 'CN' ? COZE_CN_DATASET_ID : COZE_GLOBAL_DATASET_ID;
    const endpoint = region === 'CN' ? API_CN : API_GLOBAL;

    if (!token) return;

    console.log(`   [${region}] Uploading ${path.basename(filePath)}...`);

    // Mocking the API call - in production, use fetch/axios
    // await fetch(endpoint, {
    //     method: 'POST',
    //     headers: {
    //         'Authorization': `Bearer ${token}`,
    //         'Content-Type': 'application/json'
    //     },
    //     body: JSON.stringify({
    //         dataset_id: datasetId,
    //         document_infos: [{
    //             name: path.basename(filePath),
    //             content: content,
    //             type: 'text'
    //         }]
    //     })
    // });

    // Simulate network delay
    await new Promise(r => setTimeout(r, 1000));
}

async function processFile(filePath) {
    console.log(`Processing: ${filePath}`);
    try {
        const content = fs.readFileSync(filePath, 'utf-8');

        // Calculate hash (optional, can be used for local cache check)
        const hash = crypto.createHash('md5').update(content).digest('hex');

        // Parallel upload to both regions
        await Promise.all([
            uploadToCoze(filePath, content, 'CN'),
            uploadToCoze(filePath, content, 'GLOBAL')
        ]);

    } catch (e) {
        console.error(`‚ùå Failed to process ${filePath}:`, e.message);
    }
}

async function main() {
    console.log('üöÄ Starting Knowledge Base Sync...');

    const files = getChangedFiles();
    if (files.length === 0) {
        console.log('‚úÖ No markdown files changed.');
        return;
    }

    console.log(`Found ${files.length} files to sync.`);

    // Process sequentially to be nice to rate limits (or simple concurrency)
    for (const file of files) {
        // Ensure path is correct relative to cwd
        const relativePath = file.startsWith(BLOG_DIR) ? file : path.join(BLOG_DIR, path.basename(file)); // loose handling

        // If git returned full paths, use them. If glob returned paths, they are relative.
        // We just ensure it exists.
        if (fs.existsSync(file)) {
            await processFile(file);
        } else if (fs.existsSync(path.resolve(file))) {
            await processFile(path.resolve(file));
        } else {
            console.warn(`‚ö†Ô∏è  File not found: ${file}`);
        }
    }

    console.log('‚úÖ Sync complete.');
}

main().catch(console.error);
</file>

<file path="src/components/Galaxy3D.vue">
<script setup>
import { onMounted, ref, onUnmounted, watch, toRaw } from 'vue';
import ForceGraph3D from '3d-force-graph';
import * as THREE from 'three';

const props = defineProps({
  graphData: {
    type: Object,
    default: () => ({ nodes: [], links: [] })
  },
  onNodeClick: {
    type: Function,
    default: () => {}
  }
});

const galaxyContainer = ref(null);
let graph = null;

const focusNode = (node) => {
  if (!graph || !node) return;
  
  const distance = 80;
  
  // Directly move camera to a position relative to the node
  // This avoids the 'approaching and then distancing' effect caused by vector scaling
  graph.cameraPosition(
    { x: node.x, y: node.y, z: node.z + distance },
    node, // look-at node
    2000  // Slightly faster transition for snappier feel
  );
};

const resetView = () => {
    if (!graph) return;
    graph.zoomToFit(2000);
    const controls = graph.controls();
    if (controls) {
        controls.autoRotate = true;
    }
};

defineExpose({ focusNode, resetView });

onMounted(async () => {
  // Initialize graph
  graph = ForceGraph3D()(galaxyContainer.value)
    .graphData(toRaw(props.graphData))
    .backgroundColor('#000005') // Deep black
    .showNavInfo(false)
    .nodeLabel('name') // Show name on hover
    .nodeRelSize(4)
    .linkWidth(1)
    .linkOpacity(0.3)
    .linkColor(() => '#ffffff') // White links
    .nodeThreeObject(node => {
      // Create a sprite for the node
      // Using a simple circle texture generated on canvas for performance/simplicity
      // or we could load a "glow.png" if we had one.
      // Let's generate a glowing circle texture.
      
      const canvas = document.createElement('canvas');
      canvas.width = 64;
      canvas.height = 64;
      const context = canvas.getContext('2d');
      const gradient = context.createRadialGradient(32, 32, 0, 32, 32, 32);
      
      // Color based on category (simple hash or preset)
      const color = getNodeColor(node.category);
      
      gradient.addColorStop(0, color);
      gradient.addColorStop(0.2, color);
      gradient.addColorStop(0.5, 'rgba(' + hexToRgb(color) + ', 0.3)');
      gradient.addColorStop(1, 'rgba(0,0,0,0)');
      
      context.fillStyle = gradient;
      context.fillRect(0, 0, 64, 64);
      
      const texture = new THREE.CanvasTexture(canvas);
      const material = new THREE.SpriteMaterial({ 
          map: texture,
          transparent: true,
          depthWrite: false,
          blending: THREE.AdditiveBlending
      });
      const sprite = new THREE.Sprite(material);
      
      // Scale based on "val" (citation count/weight)
      const scale = 4 + (node.val || 0) * 2;
      sprite.scale.set(scale, scale, scale);
      
      return sprite;
    })
    .onNodeClick(node => {
        focusNode(node);
        props.onNodeClick(node);
    })
    .onBackgroundClick(() => {
        // Reset view or just close bottom sheet
        props.onNodeClick(null);
    })
    .onNodeHover(node => {
        // Desktop only: change cursor and maybe highlight
        if (window.innerWidth > 1200) {
            galaxyContainer.value.style.cursor = node ? 'pointer' : null;
        }
    });

  // Optimize simulation speed
  graph.cooldownTicks(60);      // Extremely fast stabilization for instant feedback
  graph.d3AlphaDecay(0.08);     // Very aggressive settling
  graph.d3VelocityDecay(0.4);   // Rapidly bleed off kinetic energy
  
  // Custom force to keep separate clusters from drifting too far
  // This pulls nodes towards the center even if they aren't linked to the origin
  graph.d3Force('charge').strength(-40); // Slightly weaker repulsion
  graph.d3Force('center').strength(0.8); // Stronger centering
  
  // Track initial load to auto-fit view once
  let initialFitDone = false;
  graph.onEngineStop(() => {
    if (!initialFitDone) {
      graph.zoomToFit(1000, 150); // Faster animation, generous padding
      initialFitDone = true;
    }
  });  // Custom controls settings based on device
  const controls = graph.controls();
  if (controls) {
      controls.enableDamping = true;
      controls.dampingFactor = 0.1;
      // Disable panning to keep the galaxy centered
      controls.enablePan = false;
      
      // Aesthetic: Idle rotation
      controls.autoRotate = true;
      controls.autoRotateSpeed = 0.5;
  }

  // Add background cosmic dust
  addCosmicDust(graph.scene());

  // Disable auto-rotate on interaction
  const stopAutoRotate = () => {
      if (controls) controls.autoRotate = false;
  };
  galaxyContainer.value.addEventListener('mousedown', stopAutoRotate);
  galaxyContainer.value.addEventListener('touchstart', stopAutoRotate);

  // Handle container resizing
  const resizeObserver = new ResizeObserver(() => {
    if (graph && galaxyContainer.value) {
      const { clientWidth, clientHeight } = galaxyContainer.value;
      graph.width(clientWidth);
      graph.height(clientHeight);
    }
  });
  resizeObserver.observe(galaxyContainer.value);

  // Watch for data changes (async load from parent)
  watch(() => props.graphData, (newData) => {
    if (graph && newData && newData.nodes && newData.nodes.length > 0) {
      graph.graphData(toRaw(newData));
      // Reset fit flag so it frames the newly loaded data
      initialFitDone = false;
    }
  }, { deep: true });
  
  onUnmounted(() => {
      resizeObserver.disconnect();
      if (graph) {
          graph._destructor();
      }
  });
});

function getNodeColor(category) {
    const colors = {
        'Design': '#00d2ff', // Blue
        'Code': '#00ff41',   // Green
        'Essay': '#ffffff',  // White
        'Life': '#ff0055',   // Red/Pink
    };
    return colors[category] || '#ffffff';
}

function hexToRgb(hex) {
    const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? 
        parseInt(result[1], 16) + ',' + parseInt(result[2], 16) + ',' + parseInt(result[3], 16)
        : '255,255,255';
}

function addCosmicDust(scene) {
    const geometry = new THREE.BufferGeometry();
    const vertices = [];
    for (let i = 0; i < 2000; i++) {
        vertices.push(
            Math.random() * 2000 - 1000,
            Math.random() * 2000 - 1000,
            Math.random() * 2000 - 1000
        );
    }
    geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
    const material = new THREE.PointsMaterial({
        color: 0x888888,
        size: 1.5,
        transparent: true,
        opacity: 0.5,
        sizeAttenuation: true
    });
    const points = new THREE.Points(geometry, material);
    scene.add(points);
}

</script>

<template>
  <div ref="galaxyContainer" class="galaxy-container"></div>
</template>

<style scoped>
.galaxy-container {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  z-index: 10;
  overflow: hidden;
}
</style>
</file>

<file path="src/components/GalaxyBottomSheet.vue">
<script setup>
import { computed, ref } from 'vue';

const props = defineProps({
  node: {
    type: Object,
    default: null
  },
  graphData: {
    type: Object,
    default: () => ({ nodes: [], links: [] })
  },
  visible: {
    type: Boolean,
    default: false
  }
});

const emit = defineEmits(['close', 'locate']);

const isRelatedExpanded = ref(false);

const neighbors = computed(() => {
    if (!props.node || !props.graphData.links) return [];
    
    // Find all links connected to current node
    const relatedLinks = props.graphData.links.filter(link => 
        link.source === props.node.id || link.target === props.node.id ||
        (link.source.id === props.node.id) || (link.target.id === props.node.id) // handle both object and ID forms
    );
    
    // Get unique neighbor IDs
    const neighborIds = new Set();
    relatedLinks.forEach(link => {
        const sId = typeof link.source === 'object' ? link.source.id : link.source;
        const tId = typeof link.target === 'object' ? link.target.id : link.target;
        
        if (sId !== props.node.id) neighborIds.add(sId);
        if (tId !== props.node.id) neighborIds.add(tId);
    });
    
    // Map to full node objects
    return Array.from(neighborIds).map(id => {
        return props.graphData.nodes.find(n => n.id === id);
    }).filter(n => n); // remove undefined
});

function getLink(node) {
    if (!node) return '#';
    const { type, slug } = node;
    if (type === 'friend') return '/friends';
    if (type === 'profile') return '/contact';
    return `/${type}/${slug}`; 
}

const articleLink = computed(() => getLink(props.node));

function handleLocate(neighborId) {
    emit('locate', neighborId);
}

const sheetRef = ref(null);
defineExpose({ sheetRef });
</script>

<template>
  <div ref="sheetRef" class="bottom-sheet" :class="{ 'is-visible': visible }">
    <div class="sheet-content" v-if="node">
      <div class="sheet-header">
        <span class="category-tag">{{ node.category }}</span>
        <button class="close-btn" @click="$emit('close')">&times;</button>
      </div>
      <h3 class="title">{{ node.name }}</h3>
      <p class="description">{{ node.desc || 'No description available.' }}</p>
      
      <div class="primary-actions">
        <router-link :to="articleLink" class="read-btn">Read Article</router-link>
      </div>

      <!-- Related Nodes List -->
      <div class="related-section" v-if="neighbors.length > 0" :class="{ 'is-expanded': isRelatedExpanded }">
        <div class="related-header" @click="isRelatedExpanded = !isRelatedExpanded">
           <span>Related Entries ({{ neighbors.length }})</span>
           <i class="fal fa-chevron-down chevron-icon" :class="{ 'is-expanded': isRelatedExpanded }"></i>
        </div>
        <div class="expand-wrapper" :class="{ 'is-expanded': isRelatedExpanded }">
          <div class="related-list">
            <div v-for="neighbor in neighbors" :key="neighbor.id" class="related-item">
               <span class="related-title">{{ neighbor.name }}</span>
               <div class="related-actions">
                  <button class="action-btn locate" @click="handleLocate(neighbor.id)">Locate</button>
                  <router-link :to="getLink(neighbor)" class="action-btn read">Read</router-link>
               </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<style scoped>
/* Custom Scrollbar */
.sheet-content::-webkit-scrollbar,
.related-list::-webkit-scrollbar,
.description::-webkit-scrollbar {
    width: 4px;
    height: 0; /* Hide horizontal scrollbar */
}

.sheet-content::-webkit-scrollbar-track,
.related-list::-webkit-scrollbar-track,
.description::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
}

.sheet-content::-webkit-scrollbar-thumb,
.related-list::-webkit-scrollbar-thumb,
.description::-webkit-scrollbar-thumb {
    background: transparent; /* Invisible by default */
    border-radius: 10px;
}

.sheet-content:hover::-webkit-scrollbar-thumb,
.related-list:hover::-webkit-scrollbar-thumb,
.description:hover::-webkit-scrollbar-thumb {
    background: rgba(219, 169, 28, 0.3); /* Show on hover */
}

.sheet-content::-webkit-scrollbar-thumb:hover,
.related-list::-webkit-scrollbar-thumb:hover,
.description::-webkit-scrollbar-thumb:hover {
    background: rgba(219, 169, 28, 0.5); /* Highlight on thumb hover */
}

.expand-wrapper {
    display: grid;
    grid-template-rows: 0fr;
    transition: grid-template-rows 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.3s ease;
    opacity: 0;
    overflow: hidden;
}

.expand-wrapper.is-expanded {
    grid-template-rows: 1fr;
    opacity: 1;
    flex: 1;
    min-height: 0;
    display: flex;
    flex-direction: column;
}

.chevron-icon {
    transition: transform 0.3s ease;
}

.chevron-icon.is-expanded {
    transform: rotate(180deg);
}

.bottom-sheet {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: rgba(20, 20, 25, 0.95);
  backdrop-filter: blur(10px);
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  padding: 20px;
  border-radius: 20px 20px 0 0;
  transform: translateY(100%);
  transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  z-index: 2000;
  color: #fff;
  box-sizing: border-box;
  max-height: 85vh;
  display: flex;
  flex-direction: column;
}

.sheet-content {
    display: flex;
    flex-direction: column;
    flex: 1;
    min-height: 0;
    width: 100%;
}

.bottom-sheet.is-visible {
  transform: translateY(0);
}

.sheet-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

/* Related Section Styles */
.related-section {
    margin-top: 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.05);
    padding-top: 15px;
}

.related-section.is-expanded {
    display: flex;
    flex-direction: column;
    min-height: 0;
    flex: 1;
}

.related-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 14px;
    font-weight: 600;
    color: #DBA91C;
    cursor: pointer;
    margin-bottom: 10px;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
}

.related-list {
    min-height: 0;
    flex: 1;
    overflow-y: hidden; /* Hide during potential parent transition */
    overflow-x: hidden;
}

.is-expanded .related-list {
    overflow-y: auto;
    /* Delay scrollability until expansion is complete to avoid scrollbar flicker */
    transition: overflow-y 0s 0.4s; 
}

@media (max-width: 1200px) {
    .bottom-sheet {
        max-height: 50vh;
    }
}

.related-item {
    padding: 10px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 8px;
    margin-bottom: 8px;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.related-title {
    font-size: 13px;
    line-height: 1.4;
}

.related-actions {
    display: flex;
    gap: 10px;
}

.action-btn {
    flex: 1;
    font-size: 11px;
    padding: 6px;
    border-radius: 4px;
    text-align: center;
    text-decoration: none;
    font-weight: 600;
    border: none;
    cursor: pointer;
    transition: all 0.2s;
}

.action-btn.locate {
    background: rgba(219, 169, 28, 0.1);
    color: #DBA91C;
    border: 1px solid rgba(219, 169, 28, 0.3);
}

.action-btn.read {
    background: rgba(255, 255, 255, 0.05);
    color: #fff;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.action-btn:hover {
    background: rgba(255, 255, 255, 0.15);
}

@media (min-width: 1201px) {
    .bottom-sheet {
        bottom: auto;
        left: auto;
        top: 20px;
        right: 20px;
        width: 360px;
        height: auto;
        max-height: calc(100vh - 40px);
        background: rgba(20, 20, 25, 0.85);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        transform: translateX(120%);
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }

    .bottom-sheet.is-visible {
        transform: translateX(0);
    }
}

.category-tag {
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: #888;
  border: 1px solid #333;
  padding: 3px 6px;
  border-radius: 4px;
}

.close-btn {
  background: none;
  border: none;
  color: #fff;
  font-size: 24px;
  cursor: pointer;
  padding: 0 8px;
}

.title {
  font-size: 18px;
  margin: 0 0 8px 0;
  font-weight: 600;
}

.description {
  font-size: 13px;
  color: #ccc;
  line-height: 1.5;
  margin-bottom: 20px;
  max-height: 80px;
  overflow-y: auto;
  overflow-x: hidden;
}

.read-btn {
  display: block;
  width: 100%;
  padding: 10px;
  background: #DBA91C;
  color: #000;
  text-align: center;
  text-decoration: none;
  font-weight: 600;
  border-radius: 6px;
  transition: background 0.2s;
  font-size: 14px;
}

.read-btn:hover {
  background: #f0b924;
}
</style>
</file>

<file path="src/components/HelloWorld.vue">
<script setup>
import { ref } from 'vue'

defineProps({
  msg: String,
})

const count = ref(0)
</script>

<template>
  <h1>{{ msg }}</h1>

  <div class="card">
    <button type="button" @click="count++">count is {{ count }}</button>
    <p>
      Edit
      <code>components/HelloWorld.vue</code> to test HMR
    </p>
  </div>

  <p>
    Check out
    <a href="https://vuejs.org/guide/quick-start.html#local" target="_blank"
      >create-vue</a
    >, the official Vue + Vite starter
  </p>
  <p>
    Learn more about IDE Support for Vue in the
    <a
      href="https://vuejs.org/guide/scaling-up/tooling.html#ide-support"
      target="_blank"
      >Vue Docs Scaling up Guide</a
    >.
  </p>
  <p class="read-the-docs">Click on the Vite and Vue logos to learn more</p>
</template>

<style scoped>
.read-the-docs {
  color: #888;
}
</style>
</file>

<file path="src/components/TheAiAssistant.vue">
<script setup>
import { onMounted, onUnmounted, ref, watch } from 'vue';
import { detectRegion, getBotId, getToken } from '../config/ai';
import { useAppStore } from '../stores/app';

const appStore = useAppStore();
const isVisible = ref(false);

watch(() => appStore.isLoading, (loading) => {
  if (!loading) {
     isVisible.value = true;
  }
});

const LOAD_TIMEOUT = 5000;
let isLoaded = false;
let cozeClientInstance = null; // Store client instance

// Draggable Logic
const isDragging = ref(false);

const isMobile = window.innerWidth < 768;
const position = ref({ 
  bottom: isMobile ? 100 : 80, 
  right: isMobile ? 20 : 80 
});

const dragStart = ref({ x: 0, y: 0 });
const startPos = ref({ bottom: 0, right: 0 });
// Track if it was a drag or a click
const hasMoved = ref(false);
const isChatOpen = ref(false);

function onMouseDown(e) {
  // Only drag if clicking the "icon" area (approx size of button)
  // or just drag the whole wrapper since it wraps the button?
  // Coze button is inside this wrapper.
  
  isDragging.value = true;
  hasMoved.value = false;
  dragStart.value = { x: e.clientX, y: e.clientY };
  startPos.value = { ...position.value };
  
  document.addEventListener('mousemove', onMouseMove);
  document.addEventListener('mouseup', onMouseUp);
}

function onMouseMove(e) {
  if (!isDragging.value) return;
  
  const dx = e.clientX - dragStart.value.x;
  const dy = e.clientY - dragStart.value.y;
  
  if (Math.abs(dx) > 3 || Math.abs(dy) > 3) {
      hasMoved.value = true;
  }
  
  // Update position (inverted because we use bottom/right)
  position.value = {
    bottom: startPos.value.bottom - dy,
    right: startPos.value.right - dx
  };
}

function onMouseUp(e) {
  isDragging.value = false;
  document.removeEventListener('mousemove', onMouseMove);
  document.removeEventListener('mouseup', onMouseUp);
  
  // If it was a click (not a drag), toggle the chat
  if (!hasMoved.value && cozeClientInstance) {
      try {
          cozeClientInstance.showChatBot();
          // Fallback: Force state to open for Desktop Drag logic
          // Use timeout to allow SDK to render
          setTimeout(() => {
              isChatOpen.value = true;
          }, 200);
      } catch (err) {
          console.error('Failed to show chat bot', err);
      }
  }
}

// Global click listener to detect "Close"
function onGlobalClick(e) {
    if (isChatOpen.value && !isDragging.value) {
        // Simple heuristic: If we click outside container, set false.
        const container = document.querySelector('.draggable-widget-container');
        if (container && !container.contains(e.target)) {
            isChatOpen.value = false;
        }
    }
}

onMounted(() => {
    document.addEventListener('click', onGlobalClick);
    const region = detectRegion(); // Re-add region detection which was inside onMounted


// Touch support for mobile
function onTouchStart(e) {
  isDragging.value = true;
  hasMoved.value = false;
  dragStart.value = { x: e.touches[0].clientX, y: e.touches[0].clientY };
  startPos.value = { ...position.value };
  
  document.addEventListener('touchmove', onTouchMove, { passive: false });
  document.addEventListener('touchend', onTouchEnd);
}

function onTouchMove(e) {
  if (!isDragging.value) return;
  // e.preventDefault(); // Stop scrolling while dragging?
  
  const dx = e.touches[0].clientX - dragStart.value.x;
  const dy = e.touches[0].clientY - dragStart.value.y;
  
  if (Math.abs(dx) > 3 || Math.abs(dy) > 3) {
      hasMoved.value = true;
      if (e.cancelable) e.preventDefault();
  }
  
  position.value = {
    bottom: startPos.value.bottom - dy,
    right: startPos.value.right - dx
  };
}

function onTouchEnd() {
  isDragging.value = false;
  document.removeEventListener('touchmove', onTouchMove);
  document.removeEventListener('touchend', onTouchEnd);
  
  if (!hasMoved.value && cozeClientInstance) {
      try {
          cozeClientInstance.showChatBot();
      } catch (err) {}
  }
}

// URLs for Coze SDKs
const SDK_URL_CN = 'https://lf-cdn.coze.cn/obj/unpkg/flow-platform/chat-app-sdk/1.1.0-beta.3/libs/cn/index.js';
const SDK_URL_GLOBAL = 'https://sf-coze-web-cdn.coze.com/obj/unpkg-va/flow-platform/chat-app-sdk/1.1.0-beta.3/libs/oversea/index.js';

function loadScript(url) {
  return new Promise((resolve, reject) => {
    if (document.querySelector(`script[src="${url}"]`)) {
      resolve();
      return;
    }

    const script = document.createElement('script');
    script.src = url;
    script.async = true;
    
    const timeoutId = setTimeout(() => {
      script.onerror = null;
      script.onload = null;
      reject(new Error(`Timeout loading script: ${url}`));
    }, LOAD_TIMEOUT);

    script.onload = () => {
      clearTimeout(timeoutId);
      resolve();
    };

    script.onerror = (e) => {
      clearTimeout(timeoutId);
      reject(e);
    };

    document.body.appendChild(script);
  });
}

async function initCoze(region) {
  const botId = getBotId(region);
  if (!botId || botId.includes('xxxx')) {
    console.warn('Coze Bot ID not configured. AI Assistant will not load.');
    return;
  }

  // Determine URL based on region
  const url = region === 'CN' ? SDK_URL_CN : SDK_URL_GLOBAL;

  try {
    await loadScript(url);
    
    if (window.CozeWebSDK) {
      cozeClientInstance = new window.CozeWebSDK.WebChatClient({
        config: {
          bot_id: botId,
        },
        auth: {
            type: 'token',
            token: getToken(region),
            onRefreshToken: async () => getToken(region), // Simple PAT refresh (static)
        },
        componentProps: {
            title: 'Wasker AI',
            layout: window.innerWidth < 768 ? 'mobile' : 'pc', 
        },
        el: document.getElementById('coze-chat-container'),
      });
      isLoaded = true;

      // Dynamic Mobile Positioning & State Logic:
      const container = document.getElementById('coze-chat-container');
      const resizeObserver = new ResizeObserver((entries) => {
          for (const entry of entries) {
              const height = entry.contentRect.height;
              console.log('[ResizeObserver] Height:', height);
              const isOpen = height > 100;
              // Only update if true? to avoid jitter? No, faithful update.
              // Logic: specific fallback handles the 'True' case if this misses.
              // But if this reports < 100 consistently, it will overwrite our fallback True!
              // Fix: Only update isChatOpen from observer if it detects OPEN.
              // If it detects CLOSED (<100), only update if safe?
              
              if (isOpen) {
                 isChatOpen.value = true;
              } else {
                 // If we forced it open manually, but observer says small...
                 // It means container didn't grow.
                 // We should NOT overwrite to false if we believe it's open?
                 // But wait, if we minimize, we need it to go false.
                 // Let's assume Observer is valid for Mobile, but maybe not Desktop.
                 
                 if (window.innerWidth < 768) {
                     isChatOpen.value = false;
                 } else {
                     // Desktop: If height is small, it MIGHT be closed.
                     // But if Coze is fixed pos, it is ALWAYS small.
                     // So Observer is useless for Open state on Desktop?
                     // If so, we rely purely on Manual Toggle.
                 }
              }

              if (window.innerWidth < 768) {
                  if (isOpen) {
                      position.value.bottom = 0;
                      position.value.right = 0; 
                  } else {
                      position.value.bottom = 100;
                      position.value.right = 20;
                  }
              }
          }
      });
      resizeObserver.observe(container);
    }
  } catch (error) {
    console.error('Failed to load Coze SDK:', error);
    if (region === 'GLOBAL') {
        console.log('Attempting failover to CN SDK...');
    }
  }
}

    console.log(`Initializing AI Assistant for region: ${region}`);
    
    setTimeout(() => {
      initCoze(region);
    }, 1000);
});

onUnmounted(() => {
    document.removeEventListener('click', onGlobalClick);
    document.removeEventListener('mousemove', onMouseMove);
    document.removeEventListener('mouseup', onMouseUp);
    document.removeEventListener('touchmove', onTouchMove);
    document.removeEventListener('touchend', onTouchEnd);
});
</script>

<template>
  <div 
    class="draggable-widget-container"
    :class="{ 
      'mobile-open': isMobile && isChatOpen,
      'desktop-open': !isMobile && isChatOpen 
    }"
    v-show="isVisible"
    :style="!isChatOpen || !isMobile ? { bottom: position.bottom + 'px', right: position.right + 'px' } : {}"
    @mousedown="onMouseDown"
    @touchstart="onTouchStart"
  >
    <!-- Coze Container -->
    <!-- We removed the handle. The container itself captures events? 
         Note: The Coze button is inside an iframe usually, which swallows events.
         Possible Fix: We need a transparent overlap on top of the button area to capture drag?
         Or we assume Coze renders a DOM element we can bubble events from?
         Coze SDK usually puts a button in Shadow DOM or iframe. 
         
         We will place a transparent overlay 'shield' only over the button area.
         But since we drag the container, we might just put a full size shield?
         But then we can't click the input box inside the chat when open!
         
         Dynamic Shield:
         Only show the drag shield when the chat is CLOSED (small height).
    -->
    <div id="coze-chat-container" class="coze-target"></div>
    
    <!-- Drag Shield: 
         - Closed: Covers Icon (full)
         - Desktop Open: Covers Header (Top Strip) for dragging
         - Mobile Open: Hidden (via CSS)
    -->
    <div class="drag-shield"></div>
  </div>
</template>

<style scoped>
.draggable-widget-container {
  position: fixed;
  z-index: 9999;
  display: flex;
  flex-direction: column;
  align-items: flex-end; /* Align right */
}

/* 
   The shield covers the button to allow dragging.
   But we need to pass clicks through or handle them manually.
   Since we handle custom click -> showChatBot(), this works.
   We need to size it to cover roughly the button size (60x60).
   The problem is centering it over the unknown internal button.
   Safest bet: make the shield the size of the container, but 
   pointer-events: none when chat is open?
*/

.drag-shield {
    /* Default: Cover Icon (Closed state) */
    position: absolute;
    inset: 0; 
    z-index: 10000; /* Above Coze iframe */
    cursor: move;
    background: transparent; 
}

/* Mobile Open: Hide shield */
.draggable-widget-container.mobile-open .drag-shield {
    display: none;
}

/* Desktop Open: Header Shield */
.draggable-widget-container.desktop-open .drag-shield {
    height: 60px; /* Approx header height */
    bottom: auto;
    top: 0;
    width: 85%; /* Leave right side open for buttons */
    left: 0;
    /* DEBUG: Visible Blue Shield to show draggable area */
    background: rgba(0, 100, 255, 0.3);
    border-bottom: 2px solid cyan;
}

/* If the container grows (chat opens), we must disable the shield so user can interact with chat */
/* We can use :has() or JS logic. Since we used ResizeObserver before, let's reuse logic? 
   Actually, simply check if height is large?
*/

.coze-target {
  width: auto;
  height: auto;
}
</style>
</file>

<file path="src/components/TheRightBar.vue">
<script setup>
import { onMounted, onUnmounted, ref, watch, computed } from 'vue'
import { RouterLink } from 'vue-router'
import { useMarkdown } from '@/composables/useMarkdown'

const typingElement = ref(null)
const { getProfile } = useMarkdown()
const profile = getProfile() // Returns a computed ref

const typeSpeed = 70
const backSpeed = 20
const backDelay = 1500

let timeoutId = null

function typeText(element, strings) {
    if (!strings || !strings.length) return;

    let currentStringIndex = 0
    let currentCharIndex = 0
    let isDeleting = false

    const loop = () => {
         if (!element) return;
         
         const currentString = strings[currentStringIndex]
         
         if (isDeleting) {
             currentCharIndex--
         } else {
             currentCharIndex++
         }
         
         element.textContent = currentString.substring(0, currentCharIndex)
         
         let nextDelay = typeSpeed
         if (isDeleting) nextDelay = backSpeed
         
         if (!isDeleting && currentCharIndex === currentString.length) {
             nextDelay = backDelay
             isDeleting = true
         } else if (isDeleting && currentCharIndex === 0) {
             isDeleting = false
             currentStringIndex = (currentStringIndex + 1) % strings.length
             nextDelay = 500
         }
         
         timeoutId = setTimeout(loop, nextDelay)
    }
    loop()
}

// Start typing when both profile and element are ready
const startTyping = () => {
    if (profile.value && profile.value.roles && typingElement.value) {
        if (timeoutId) clearTimeout(timeoutId);
        typeText(typingElement.value, profile.value.roles);
    }
}

// Watch for changes (Data loaded or HMR)
watch(() => profile.value, startTyping);

// Also start on mount (Component render)
onMounted(() => {
    startTyping();

    // Init Swiper (Keep existing swiper logic if it was there, though I might have overwritten it, let's check)
})

onUnmounted(() => {
    if (timeoutId) clearTimeout(timeoutId)
})
</script>

<template>
  <div class="mil-content-frame mil-cloned">
    <div class="mil-scroll mil-half-2">
      <div class="mil-main-content">
        <div class="mil-banner" v-if="profile">
          <div class="mil-bg-frame">
            <img :src="profile.banner" alt="banner" class="mil-banner-bg mil-scale-img" data-value-1="1"
              data-value-2="1.3">
          </div>
          <div class="mil-banner-overlay"></div>
          <div class="mil-banner-content">
            <div class="mil-avatar mil-mb-30">
              <img :src="profile.avatar" alt="avatar">
            </div>
            <h1 class="mil-mb-15">{{ profile.name }}</h1>
            <div class="mil-link">I'm a <span class="mil-typing" ref="typingElement"></span></div>
          </div>
        </div>
        <div class="mil-space-90 mil-p-0-75" v-if="profile">
          <div class="mil-title-line mil-mb-60 mil-up">
            <h2>Services</h2>
            <div class="mil-line"></div>
            <div class="mil-h2 mil-number">01</div>
          </div>
          <div class="row mil-mb-75">
            <div class="col-xs-12 col-sm-6 mil-mb-15" v-for="(service, index) in profile.services" :key="index">
              <div class="mil-service-card mil-up">
                <h3 class="mil-mb-20"><span class="mil-accent">{{ String(index + 1).padStart(2, '0') }}.</span> {{ service.title }}
                </h3>
                <p class="mil-mb-20-plus">{{ service.description }}</p>
                <router-link :to="service.link" class="mil-link mil-hover-link">Order
                  service</router-link>
              </div>
            </div>
          </div>
          <div class="mil-title-line mil-mb-60 mil-up">
            <h2>Language</h2>
            <div class="mil-line"></div>
            <div class="mil-h2 mil-number">02</div>
          </div>
          <div class="row mil-mb-60">
            <div class="col-xs-12 col-sm-6 mil-mb-30" v-for="(lang, index) in profile.languages" :key="index">
              <div class="mil-skill-item mil-up">
                <div class="mil-top">
                  <span class="mil-link">{{ lang.name }}</span>
                  <span>{{ lang.level }}</span>
                </div>
                <div class="mil-progress">
                  <div class="mil-progress-prog mil-add-class" :style="{ width: lang.percent + '%' }"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="mil-title-line mil-mb-60 mil-up">
            <h2>Skills</h2>
            <div class="mil-line"></div>
            <div class="mil-h2 mil-number">03</div>
          </div>
          <div class="row mil-mb-60">
             <div class="col-xs-12 col-sm-6 mil-mb-30" v-for="(skill, index) in profile.skills" :key="index">
              <div class="mil-skill-item mil-up">
                <div class="mil-top">
                  <span class="mil-link">{{ skill.name }}</span>
                  <span>{{ skill.percent }}%</span>
                </div>
                <div class="mil-progress">
                  <div class="mil-progress-prog mil-add-class" :style="{ width: skill.percent + '%' }"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="mil-title-line mil-mb-60 mil-up">
              <h2>Education</h2>
              <div class="mil-line"></div>
              <div class="mil-h2 mil-number">04</div>
          </div>
          <ul class="mil-timeline mil-mb-75">
              <li class="mil-mb-15 mil-up" v-for="(edu, index) in profile.education" :key="index">
                  <div class="mil-timeline-card">
                      <div class="mil-left">
                          <h3 class="mil-line-height mil-mb-20"><span
                                  class="mil-accent">{{ String(index + 1).padStart(2, '0') }}.</span> {{ edu.title }}</h3>
                          <div class="mil-badge mil-dark mil-mb-20-plus">{{ edu.year }}</div>
                          <a v-if="edu.certificate" :href="edu.certificate"
                               class="mil-link mil-hover-link" data-fancybox="certificate"
                               data-no-swup>Certificate</a>
                      </div>
                      <div class="mil-right">
                          <p class="">{{ edu.description }}</p>
                      </div>
                  </div>
              </li>
          </ul>
          <div class="mil-title-line mil-mb-60 mil-up">
              <h2>Work</h2>
              <div class="mil-line"></div>
              <div class="mil-h2 mil-number">05</div>
          </div>
          <ul class="mil-timeline mil-mb-75">
              <li class="mil-mb-15 mil-up" v-for="(job, index) in profile.work" :key="index">
                  <div class="mil-timeline-card">
                      <div class="mil-left">
                          <h3 class="mil-line-height mil-mb-20"><span
                                  class="mil-accent">{{ String(index + 1).padStart(2, '0') }}.</span> {{ job.title }}</h3>
                          <div class="mil-badge mil-dark mil-mb-20-plus">{{ job.year }}</div>
                      </div>
                      <div class="mil-right">
                          <p class="">{{ job.description }}</p>
                      </div>
                  </div>
              </li>
          </ul>
          <div class="mil-divider mil-mb-60 mil-up"></div>
          <div class="mil-mb-30 mil-up" v-html="profile.body"></div>
          <ul class="mil-social mil-up">
            <li v-for="(social, index) in profile.social" :key="index">
                <a :href="social.link" target="_blank"><i :class="social.icon"></i></a>
            </li>
          </ul>
        </div>
      </div>
      <footer>
        <div class="mil-space-90 mil-jcb" v-if="profile && profile.footer">
          <p>{{ profile.footer.copyright }}</p>
          <p>Design by: <a :href="profile.footer.designer_url" class="mil-text-link" target="_blank">{{ profile.footer.designer }}</a></p>
        </div>
      </footer>
    </div>
  </div>
</template>

<style scoped>
/* Any component specific overrides */
</style>
</file>

<file path="src/composables/useMarkdown.js">
import { ref, computed } from 'vue';
import fm from 'front-matter';

// State to cache posts to avoid re-parsing on every call if not needed
// In a simple app, we can just load them once.
const posts = ref([]);
const loaded = ref(false);

export function useMarkdown() {

    const loadPosts = () => {
        if (loaded.value) return;

        // Eagerly load all markdown files from /src/content
        // We use query: '?raw' to get the string content
        const modules = import.meta.glob('@/content/**/*.md', { query: '?raw', import: 'default', eager: true });

        const allPosts = [];

        for (const path in modules) {
            const rawContent = modules[path];
            const content = fm(rawContent);
            const frontmatter = content.attributes;

            // Determine type based on path (blog vs portfolio vs friend)
            const isBlog = path.includes('/blog/');
            const isPortfolio = path.includes('/portfolio/');
            const isFriend = path.includes('/friend/');

            // Generate slug from filename
            const filename = path.split('/').pop().replace('.md', '');

            // Derive Category from Folder Name
            // Logic: path looks like .../content/blog/[category]/post.md
            // We search for 'blog' or 'portfolio' in the path, and check if there's a folder after it.
            let computedCategory = frontmatter.category;
            const pathParts = path.split('/');
            const typeIndex = pathParts.findIndex(p => p === (isBlog ? 'blog' : (isPortfolio ? 'portfolio' : 'friend')));

            // If type found and there is a folder between type and filename
            // pathParts length must be > typeIndex + 2 (type + folder + filename)
            if (typeIndex !== -1 && pathParts.length > typeIndex + 2) {
                // The folder name is immediately after the type
                const folderName = pathParts[typeIndex + 1];
                // Simple capitalization
                computedCategory = folderName.charAt(0).toUpperCase() + folderName.slice(1);
            }

            allPosts.push({
                ...frontmatter,
                category: computedCategory, // Override or keep original
                slug: filename,
                body: content.body,
                type: isBlog ? 'blog' : (isPortfolio ? 'portfolio' : (isFriend ? 'friend' : 'other')),
                path: path
            });
        }

        // Sort by date desc (assuming date is in frontmatter)
        allPosts.sort((a, b) => new Date(b.date) - new Date(a.date));

        posts.value = allPosts;
        loaded.value = true;
    };

    // Initialize loading immediately
    loadPosts();

    const getPosts = (type) => {
        return computed(() => {
            if (!type) return posts.value;
            return posts.value.filter(p => p.type === type);
        });
    };

    const getCategories = (type) => {
        return computed(() => {
            const list = type ? posts.value.filter(p => p.type === type) : posts.value;
            const allCats = list.map(p => p.category).filter(Boolean);
            // Deduplicate
            return ['All', ...new Set(allCats)];
        });
    };

    // Helper to find single post
    const getPostBySlug = (slug, type) => {
        return computed(() => {
            return posts.value.find(p => p.slug === slug && (type ? p.type === type : true));
        });
    };

    // Helper to get previous and next posts
    const getAdjacentPosts = (slug, type) => {
        return computed(() => {
            const list = type ? posts.value.filter(p => p.type === type) : posts.value;
            const index = list.findIndex(p => p.slug === slug);

            if (index === -1) return { prev: null, next: null };

            // Since list is sorted descending by date:
            // Next item in array = Older post (Previous in time) -> But usually "Next" UI means "Newer"? 
            // Actually usually "Next" means the next one to read.
            // Let's stick to Array order:
            // Prev Index (i-1) = Newer Post
            // Next Index (i+1) = Older Post
            // User request: Previous (<) and Next (>)
            // Usually < is Newer and > is Older in blog context, or vice versa?
            // Let's assume standard pagination: < Prev (Newer) | Next > (Older)

            const prev = index > 0 ? list[index - 1] : null;
            const next = index < list.length - 1 ? list[index + 1] : null;

            return { prev, next };
        });
    };

    // Helper to get Profile data (single file)
    const getProfile = () => {
        return computed(() => {
            const modules = import.meta.glob('@/content/profile/profile.md', { query: '?raw', import: 'default', eager: true });
            for (const path in modules) {
                const rawContent = modules[path];
                const content = fm(rawContent);
                return {
                    ...content.attributes,
                    body: content.body
                };
            }
            return null;
        });
    };

    return {
        posts,
        getPosts,
        getCategories,
        getPostBySlug,
        getAdjacentPosts,
        getProfile
    };
}
</file>

<file path="src/composables/useScrollAnimations.js">
import { onMounted, onUnmounted, nextTick } from 'vue'
import { gsap } from 'gsap'
import { ScrollTrigger } from 'gsap/ScrollTrigger'

gsap.registerPlugin(ScrollTrigger)

export function useScrollAnimations() {

    const killAnimations = () => {
        ScrollTrigger.getAll().forEach(t => t.kill())
        // Reset styles for elements that might be mid-animation if needed, 
        // but usually just killing triggers is enough if we are unmounting.
    }

    const initAnimations = () => {
        // Kill any existing triggers first to avoid duplication/conflicts
        killAnimations()

        // Refresh ScrollTrigger to ensure positions are correct
        ScrollTrigger.refresh()

        // Force another refresh after a short delay to account for layout shifts/transitions
        setTimeout(() => {
            ScrollTrigger.refresh()
        }, 100)

        // 1. Appearance Animation (.mil-up)
        const appearance = document.querySelectorAll(".mil-up")
        appearance.forEach(section => {
            // If we are re-initializing, we might want to reset opacity if it was already animated?
            // Or if it's a new page verify it's clean.
            // But if it's the SAME page re-init, we might reset it.
            // For navigation, the new elements come in fresh.

            // Check if already animated to avoid double fade-in on hot reload or re-init
            if (section.classList.contains('mil-animated')) {
                section.style.opacity = 1;
                section.style.pointerEvents = 'all';
                section.style.transform = 'translateY(0) scale(1)';
                return;
            }

            const container = section.closest('.mil-half-1') || section.closest('.mil-half-2') || window;

            // Only animate if element is visible/attached
            if (!document.body.contains(section)) return;

            gsap.fromTo(section, {
                opacity: 0,
                y: 40,
                scale: 0.95,
                pointerEvents: 'none',
            }, {
                y: 0,
                opacity: 1,
                scale: 1,
                duration: 0.4,
                onComplete: () => {
                    section.style.pointerEvents = 'all'
                    section.classList.add('mil-animated')
                },
                scrollTrigger: {
                    trigger: section,
                    scroller: container === window ? 'body' : container, // Handle full page vs scrollable div
                    toggleActions: 'play none none reverse',
                    start: 'top+=90px bottom',
                }
            })
        })

        // 2. Scale Image Animation (.mil-scale-img)
        const scaleImage = document.querySelectorAll(".mil-scale-img")
        scaleImage.forEach(section => {
            const container = section.closest('.mil-half-1') || section.closest('.mil-half-2') || window;
            const value1 = Math.max(0.95, section.getAttribute("data-value-1") || 1);
            const value2 = section.getAttribute("data-value-2") || 1.1;

            const startValue = window.innerWidth < 1200 ? 'top-=100 bottom-=100%' : 'top bottom-=100%';

            gsap.fromTo(section, {
                scale: value1,
                y: '0%',
            }, {
                scale: value2,
                y: '10%',
                scrollTrigger: {
                    scroller: container === window ? 'body' : container,
                    trigger: section,
                    start: startValue,
                    scrub: true,
                    toggleActions: 'play none none reverse',
                }
            })
        })

        // 3. Progress Bar (.mil-progress-prog)
        const progressBars = document.querySelectorAll('.mil-progress-prog')
        progressBars.forEach(box => {
            const size = box.getAttribute('data-size')
            if (size) box.style.setProperty('--size', size)

            const container = box.closest('.mil-half-1') || box.closest('.mil-half-2') || window;

            ScrollTrigger.create({
                trigger: box,
                scroller: container === window ? 'body' : container,
                toggleActions: 'play none none reverse',
                onEnter: () => box.classList.add('mil-active'),
                onLeaveBack: () => box.classList.remove('mil-active')
            })
        })
    }

    // Cleanup on component unmount
    onUnmounted(() => {
        killAnimations()
    })

    return {
        initAnimations,
        killAnimations
    }
}
</file>

<file path="src/config/ai.js">
/**
 * AI Assistant Configuration
 */

// Read environment variables
const COZE_CN_BOT_ID = import.meta.env.VITE_COZE_CN_BOT_ID;
const COZE_GLOBAL_BOT_ID = import.meta.env.VITE_COZE_GLOBAL_BOT_ID;
const COZE_CN_TOKEN = import.meta.env.VITE_COZE_CN_TOKEN;
const COZE_GLOBAL_TOKEN = import.meta.env.VITE_COZE_GLOBAL_TOKEN;

/**
 * Detects the user's timezone to decide which bot to load.
 * @returns {'CN' | 'GLOBAL'}
 */
export function detectRegion() {
    try {
        const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        // List of timezones to serve the CN bot to
        const cnTimeZones = [
            'Asia/Shanghai',
            'Asia/Urumqi',
            'Asia/Harbin',
            'Asia/Chongqing',
            'Asia/Kashgar'
        ];

        if (cnTimeZones.includes(timeZone)) {
            return 'CN';
        }
        return 'GLOBAL';
    } catch (e) {
        console.warn('Timezone detection failed, defaulting to GLOBAL:', e);
        return 'GLOBAL';
    }
}

/**
 * Get the Bot ID based on the region.
 * @param {'CN' | 'GLOBAL'} region 
 * @returns {string}
 */
export function getBotId(region) {
    if (region === 'CN') {
        return COZE_CN_BOT_ID;
    }
    return COZE_GLOBAL_BOT_ID;
}

/**
 * Get the Access Token based on the region.
 * @param {'CN' | 'GLOBAL'} region 
 * @returns {string}
 */
export function getToken(region) {
    if (region === 'CN') {
        return COZE_CN_TOKEN;
    }
    return COZE_GLOBAL_TOKEN;
}

export const CONFIG = {
    COZE_CN_BOT_ID,
    COZE_GLOBAL_BOT_ID
};
</file>

<file path="src/main.js">
import { createApp } from 'vue'
import { createPinia } from 'pinia'
import router from './router'
import App from './App.vue'

// Import Global Styles
import './assets/css/plugins/bootstrap-grid.css'
import './assets/css/plugins/swiper.css' // Or use swiper/css if using swiper components
import './assets/css/plugins/fontawesome.css'
import './assets/css/plugins/fancybox.css'
import './assets/css/style.css'

// Create App
const app = createApp(App)

app.use(createPinia())
app.use(router)

router.isReady().then(() => {
    app.mount('#app')
})
</file>

<file path="src/utils/markdown.js">
import MarkdownIt from 'markdown-it';
import hljs from 'highlight.js';

// Create and configure markdown-it instance
const md = new MarkdownIt({
    html: true,
    highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
            try {
                return '<pre class="hljs"><code>' +
                    hljs.highlight(str, { language: lang, ignoreIllegals: true }).value +
                    '</code></pre>';
            } catch (__) { }
        }

        return '<pre class="hljs"><code>' + md.utils.escapeHtml(str) + '</code></pre>';
    }
});

// Override fence rule to add wrapper and copy button
const defaultFence = md.renderer.rules.fence || function (tokens, idx, options, env, self) {
    return self.renderToken(tokens, idx, options);
};

md.renderer.rules.fence = function (tokens, idx, options, env, self) {
    const token = tokens[idx];
    const info = token.info ? md.utils.escapeHtml(token.info).trim() : '';
    const langName = info ? info.split(/\s+/g)[0] : '';

    // Render the original code block
    const rawCode = defaultFence(tokens, idx, options, env, self);

    // Wrap it
    return `<div class="code-wrapper">
                <div class="code-header">
                    <span class="lang-tag">${langName}</span>
                    <button class="copy-btn" data-code="${md.utils.escapeHtml(token.content)}">
                        <i class="far fa-copy"></i> Copy
                    </button>
                </div>
                ${rawCode}
            </div>`;
};

// Table styling rule (optional, can also be done via CSS)
// Ensure tables are responsive
md.renderer.rules.table_open = function () {
    return '<div class="table-responsive"><table class="table table-striped">';
};
md.renderer.rules.table_close = function () {
    return '</table></div>';
};


export default md;
</file>

<file path="src/views/BlogDetail.vue">
<script setup>
import { computed, onMounted, onUpdated, nextTick } from 'vue'
import { useRoute, useRouter } from 'vue-router'
import { useMarkdown } from '@/composables/useMarkdown'
import md from '@/utils/markdown'

const route = useRoute()
const router = useRouter()
const { getPostBySlug, getAdjacentPosts } = useMarkdown()

// The router param is named 'id' but serves as the slug
const slug = computed(() => route.params.id)
const post = getPostBySlug(slug.value, 'blog')
const adjacentPosts = getAdjacentPosts(slug.value, 'blog')

const renderedBody = computed(() => {
    return post.value ? md.render(post.value.body) : ''
})

// Intercept clicks on rendered markdown
const handleLinkClick = (event) => {
    const link = event.target.closest('a');
    if (link && link.getAttribute('href')) {
        const rawHref = link.getAttribute('href');
        const targetUrl = new URL(link.href);
        const currentOrigin = window.location.origin;

        // Check if internal link
        if (targetUrl.origin === currentOrigin) {
            event.preventDefault();
            let path = targetUrl.pathname;
            
            // Logic to handle basic markdown relative links
            // e.g., ./other-post.md -> /blog/other-post
            if (path.endsWith('.md')) {
                path = path.replace('.md', '');
                
                // If the path does not start with /blog/ or /portfolio/, assume it's a blog post
                // because we are in BlogDetail. Also check rawHref for relative up-nav
                if (!path.startsWith('/blog/') && !path.startsWith('/portfolio/')) {
                    // Check if it's likely a relative link that resolved to root
                    // e.g. ../foo.md -> /foo.md -> /foo
                    // We want /blog/foo
                    path = '/blog' + path;
                }
            }
            
            router.push(path);
        } else {
            // External link: open in new tab
            link.target = '_blank';
        }
    }
};

const attachCopyListeners = () => {
    const buttons = document.querySelectorAll('.copy-btn');
    buttons.forEach(btn => {
        btn.addEventListener('click', () => {
            const code = decodeURIComponent(btn.getAttribute('data-code'));
            navigator.clipboard.writeText(code).then(() => {
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check"></i> Copied';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                }, 2000);
            });
        });
    });
};

onMounted(() => {
   nextTick(() => attachCopyListeners());
})

onUpdated(() => {
   nextTick(() => attachCopyListeners());
})
</script>

<template>
    <div class="mil-content-frame">
        <div class="mil-scroll mil-half-1 mil-bp-fix">
            <div class="mil-main-content" v-if="post">
                <div class="mil-banner">
                    <div class="mil-bg-frame">
                        <img :src="post.image" alt="banner"
                            class="mil-banner-bg mil-scale-img" 
                            data-value-1="1" data-value-2="1.3"
                            v-if="post.image">
                    </div>
                    <div class="mil-banner-overlay"></div>
                    <div class="mil-banner-content mil-type-2">
                        <div class="mil-link mil-mb-20">{{ post.category }}</div>
                        <h1>{{ post.title }}</h1>
                    </div>
                </div>
                <div class="mil-space-90 mil-p-0-75">
                    <!-- Markdown Content with click listener -->
                    <div class="mil-markdown-content" v-html="renderedBody" @click="handleLinkClick"></div>
                </div>
            </div>
            <!-- ... -->
            
            <div v-else class="mil-p-90-75">
                <h1>Post not found</h1>
            </div>

            <div class="mil-bottom-panel">
                <div class="mil-jcc mil-space-15 mil-w-100">
                    <div class="mil-jcb mil-w-100 mil-p-30-0">
                         <!-- Previous Post (Newer) -->
                        <div class="mil-prev-nav">
                             <router-link v-if="adjacentPosts.prev" :to="'/blog/' + adjacentPosts.prev.slug" class="mil-link mil-icon-link-left" title="Previous Post">
                                <i class="fas fa-chevron-left"></i> <span>Previous</span>
                             </router-link>
                             <span v-else class="mil-link mil-disabled" style="opacity: 0.5;"><i class="fas fa-chevron-left"></i> Previous</span>
                        </div>

                        <!-- Back to Listing -->
                        <router-link to="/blog" class="mil-link">Back to Blog</router-link>

                        <!-- Next Post (Older) -->
                        <div class="mil-next-nav">
                            <router-link v-if="adjacentPosts.next" :to="'/blog/' + adjacentPosts.next.slug" class="mil-link mil-icon-link" title="Next Post">
                                <span>Next</span> <i class="fas fa-chevron-right"></i>
                            </router-link>
                            <span v-else class="mil-link mil-disabled" style="opacity: 0.5;">Next <i class="fas fa-chevron-right"></i></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<style>
/* Basic styles for markdown content if not present globaly */
.mil-markdown-content h1, 
.mil-markdown-content h2, 
.mil-markdown-content h3 {
    margin-bottom: 20px;
}
.mil-markdown-content p {
    margin-bottom: 20px;
}
.mil-markdown-content img {
    max-width: 100%;
    border-radius: 10px;
    margin: 20px 0;
}
</style>
</file>

<file path="src/views/Contact.vue">
<script setup>
const onSubmit = () => {
  alert('Thank you for your message! This is a demo form.')
}
</script>

<template>
    <div class="mil-content-frame mil-contact-frame">
        <div class="mil-scroll mil-bp-fix-2 mil-half-1">
            <div class="mil-main-content">
                <div class="mil-banner">
                    <div class="mil-bg-frame">
                        <img src="/assets/img-dark/ui/banner2.jpg" alt="banner" class="mil-banner-bg mil-scale-img"
                            data-value-1="1" data-value-2="1.3">
                    </div>
                    <div class="mil-banner-overlay"></div>
                    <div class="mil-banner-content mil-type-2">
                        <div class="mil-link mil-mb-20">contact</div>
                        <h1>Get in touch</h1>
                    </div>
                </div>
                <div class="mil-space-90 mil-p-0-75">
                    <form @submit.prevent="onSubmit">
                        <div class="row mil-aic">
                            <div class="col-sm-6 mil-mb-15">
                                <div class="mil-input-frame mil-up">
                                    <input type="text" placeholder="Your Name" name="name">
                                    <i class="fal fa-user"></i>
                                </div>
                            </div>
                            <div class="col-sm-6 mil-mb-15">
                                <div class="mil-input-frame mil-up">
                                    <input type="email" placeholder="Email" name="email">
                                    <i class="fal fa-at"></i>
                                </div>
                            </div>
                            <div class="col-lg-12 mil-mb-15">
                                <div class="mil-input-frame mil-up">
                                    <input type="text" placeholder="Subject" name="subject">
                                    <i class="fal fa-lightbulb"></i>
                                </div>
                            </div>
                            <div class="col-lg-12 mil-mb-15">
                                <div class="mil-input-frame mil-up">
                                    <textarea placeholder="Your message" name="message"></textarea>
                                    <i class="fal fa-user"></i>
                                </div>
                            </div>
                            <div class="col-12 col-sm-8 col-md-8 mil-mb-15">
                                <label class="custom-checkbox mil-up">
                                    <input type="checkbox">
                                    <span class="checkmark"></span>
                                    I consent to the processing of my personal data
                                </label>
                            </div>
                            <div class="col-12 col-sm-4 mil-mb-15 mil-jce mil-xs-jcs mil-up">
                                <button type="submit" class="mil-btn-sm">Send</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="mil-bottom-panel">
            <div class="mil-space-90">
                <div class="mil-jcb mil-w-100">
                    <a href="#" class="mil-icon-text" target="_blank">
                        <i class="fab fa-whatsapp"></i>
                        <div class="mil-link">+38 (088) 133 XX 49</div>
                    </a>
                    <a href="mailto:archer@mail.com" class="mil-icon-text" target="_blank">
                        <i class="fal fa-at"></i>
                        <div class="mil-link">archer@mail.com</div>
                    </a>
                </div>
            </div>
        </div>
    </div>
</template>
</file>

<file path="src/views/Friends.vue">
<script setup>
import { computed, watch, nextTick } from 'vue'
import { RouterLink } from 'vue-router'
import { useMarkdown } from '@/composables/useMarkdown'
import { useScrollAnimations } from '@/composables/useScrollAnimations'

const { getPosts } = useMarkdown()
const { initAnimations } = useScrollAnimations()

// Get Friend Links
const friends = getPosts('friend')

// Re-init animations when list changes/loads
watch(friends, () => {
    nextTick(() => {
        initAnimations()
    })
}, { immediate: true })
</script>

<template>
    <div class="mil-content-frame mil-up">
        <div class="mil-scroll mil-half-1 mil-bp-fix">
             <div class="mil-row-fix">
                 <div class="row">
                    <!-- Dynamic Friends List -->
                    <div class="col-lg-6" v-for="friend in friends" :key="friend.slug">
                        <div class="mil-blog-card mil-sm mil-mb-15 mil-up">
                            <img :src="friend.image" :alt="friend.shortname" v-if="friend.image">
                            <div class="mil-descr">
                                <div class="mil-post-text">
                                    <div class="mil-left">
                                        <h3 class="mil-line-height mil-mb-20">{{ friend.shortname }}</h3>
                                        <a :href="friend.url" target="_blank" class="mil-link mil-hover-link mil-accent">Visit Site</a>
                                    </div>
                                    <div class="mil-right">
                                        <p>{{ friend.description }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                 </div>
             </div>
             
             <!-- Apply Interface (Placeholder) -->
            <div class="mil-bottom-panel">
                <div class="mil-jcc mil-space-15 mil-w-100">
                    <form class="mil-subscribe">
                        <div class="mil-input-frame">
                            <input type="text" placeholder="Want to be friends? Apply simply." name="url">
                        </div>
                        <button type="submit" class="mil-btn-sm"><i class="far fa-envelope"></i></button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</template>
</file>

<file path="src/views/GalaxyPage.vue">
<script setup>
import { ref, onMounted, onUnmounted, shallowRef, nextTick } from 'vue';
import Galaxy3D from '../components/Galaxy3D.vue';
import GalaxyBottomSheet from '../components/GalaxyBottomSheet.vue';

const selectedNode = shallowRef(null);
const graphData = shallowRef({ nodes: [], links: [] });
const galaxy3dRef = ref(null);
const bottomSheetRef = ref(null);
const currentSheetHeight = ref(0);
const windowWidth = ref(window.innerWidth);

let sheetObserver = null;

const handleResize = () => {
  windowWidth.value = window.innerWidth;
};

onMounted(async () => {
  const response = await fetch('/galaxy-data.json');
  graphData.value = await response.json();

  window.addEventListener('resize', handleResize);

  // Measure bottom sheet height
  sheetObserver = new ResizeObserver((entries) => {
    for (const entry of entries) {
      currentSheetHeight.value = entry.target.offsetHeight;
    }
  });

  await nextTick();
  if (bottomSheetRef.value?.sheetRef) {
    sheetObserver.observe(bottomSheetRef.value.sheetRef);
  }
});

onUnmounted(() => {
  window.removeEventListener('resize', handleResize);
  if (sheetObserver) sheetObserver.disconnect();
});

function handleNodeClick(node) {
  if (node) {
      // Sanitize the node object to avoid circular references (Three.js objects) causing Vue reactivity crashes
      selectedNode.value = {
          id: node.id,
          name: node.name,
          desc: node.desc,
          slug: node.slug,
          type: node.type,
          category: node.category,
          val: node.val,
          filePath: node.filePath
      };
  } else {
      selectedNode.value = null;
      currentSheetHeight.value = 0;
  }
}

function handleLocate(nodeId) {
  const node = graphData.value.nodes.find(n => n.id === nodeId);
  if (node && galaxy3dRef.value) {
    galaxy3dRef.value.focusNode(node);
    selectedNode.value = node;
  }
}

function handleReset() {
    if (galaxy3dRef.value) {
        galaxy3dRef.value.resetView();
        selectedNode.value = null;
        currentSheetHeight.value = 0;
    }
}
</script>

<template>
  <div class="galaxy-page">
    <div 
      class="galaxy-viewport" 
      :class="{ 'detail-open': !!selectedNode }"
      :style="selectedNode && windowWidth <= 1200 ? { height: `calc(100% - ${currentSheetHeight}px)` } : {}"
    >
        <Galaxy3D 
          ref="galaxy3dRef"
          :graphData="graphData"
          :onNodeClick="handleNodeClick" 
        />
    </div>
    
    <button class="reset-view-btn" @click="handleReset" title="Reset View" :class="{ 'detail-open': !!selectedNode }">
        <i class="fal fa-dot-circle"></i>
    </button>

    <GalaxyBottomSheet 
      ref="bottomSheetRef"
      :node="selectedNode" 
      :graphData="graphData"
      :visible="!!selectedNode" 
      @close="selectedNode = null" 
      @locate="handleLocate"
    />
  </div>
</template>

<style scoped>
.reset-view-btn {
    position: absolute;
    bottom: 30px;
    right: 30px;
    z-index: 2200; /* Higher than BottomSheet (2000) just in case, but we will shift it */
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: rgba(20, 20, 25, 0.6);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: #fff;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
}

.reset-view-btn:hover {
    background: rgba(219, 169, 28, 0.2);
    border-color: rgba(219, 169, 28, 0.5);
    color: #DBA91C;
    transform: scale(1.1);
}

@media (max-width: 1200px) {
    /* Relocate button to top-left when BottomSheet is open on mobile/tablet */
    .reset-view-btn.detail-open {
        bottom: auto;
        right: auto;
        top: 110px; /* Below the mobile header/logo area */
        left: 20px;
        transform: scale(0.9);
        background: rgba(219, 169, 28, 0.15);
        border-color: rgba(219, 169, 28, 0.4);
    }
}

@media (min-width: 1201px) {
    .reset-view-btn {
        bottom: 40px;
        right: 40px;
    }
    
    /* Relocate button to top-left when Side Panel is open on desktop */
    .reset-view-btn.detail-open {
        bottom: auto;
        right: auto;
        top: 40px;
        left: 40px;
    }
}

.galaxy-page {
  position: relative;
  width: 100%;
  height: 100%;
  background: #000;
  overflow: hidden;
}

@media (max-width: 1200px) {
  .galaxy-page {
    height: 100vh;
    height: calc(var(--vh, 1vh) * 100);
  }
}

.ui-overlay {
    position: absolute;
    top: 20px;
    left: 20px;
    z-index: 20;
}

.back-link {
    color: rgba(255, 255, 255, 0.7);
    text-decoration: none;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.galaxy-viewport {
    width: 100%;
    height: 100%;
    transition: height 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    position: relative;
    z-index: 10;
}

@media (max-width: 1200px) {
    /* No hardcoded height here, managed by JS for precision */
}
</style>
</file>

<file path="src/views/Home.vue">
<script setup>
import TheRightBar from '../components/TheRightBar.vue'
</script>

<template>
    <!-- On Home Page, the Left Content is just a placeholder for the cloned CV in original -->
    <!-- But in Vue, since we have the RightBar on the right (Desktop) or bottom (Mobile),
         the Left Content on Home Page acts as a "spacer" or effectively empty in full width mode? 
         
         Wait, index.html has:
         <div class="mil-left-part">
            <div class="transition-fade" id="swupMain">
                 <div class="mil-cv-clone-here"></div>
            </div>
         </div>
         
         The body.mil-fw-page likely expands the layout or specific elements.
         If we don't need to clone anything, maybe Home.vue can be empty or 
         just contain the "mil-cv-clone-here" div if CSS depends on it?
    -->
    <div class="transition-fade">
         <!-- This div might be needed for consistency or transition targets -->
           <TheRightBar />
    </div>
</template>
</file>

<file path="src/views/PortfolioDetail.vue">
<script setup>
import { computed, onMounted, onUpdated, nextTick } from 'vue'
import { useRoute, useRouter, RouterLink } from 'vue-router'
import { useMarkdown } from '@/composables/useMarkdown'
import md from '@/utils/markdown'

const route = useRoute()
const router = useRouter()
const { getPostBySlug, getAdjacentPosts } = useMarkdown()

const slug = computed(() => route.params.id)
const work = getPostBySlug(slug.value, 'portfolio')
const adjacentPosts = getAdjacentPosts(slug.value, 'portfolio')

const renderedBody = computed(() => {
    return work.value ? md.render(work.value.body) : ''
})

const handleLinkClick = (event) => {
    const link = event.target.closest('a');
    if (link && link.getAttribute('href')) {
        const targetUrl = new URL(link.href);
        const currentOrigin = window.location.origin;

        if (targetUrl.origin === currentOrigin) {
            event.preventDefault();
            let path = targetUrl.pathname;
            if (path.endsWith('.md')) {
                path = path.replace('.md', '');
                // Prepend /portfolio/ if missing
                if (!path.startsWith('/blog/') && !path.startsWith('/portfolio/')) {
                    path = '/portfolio' + path;
                }
            }
            router.push(path);
        } else {
            link.target = '_blank';
        }
    }
};

const attachCopyListeners = () => {
    const buttons = document.querySelectorAll('.copy-btn');
    buttons.forEach(btn => {
        btn.addEventListener('click', () => {
            const code = decodeURIComponent(btn.getAttribute('data-code'));
            navigator.clipboard.writeText(code).then(() => {
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check"></i> Copied';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                }, 2000);
            });
        });
    });
};

onMounted(() => {
   nextTick(() => attachCopyListeners());
})

onUpdated(() => {
    nextTick(() => attachCopyListeners());
})
</script>

<template>
    <div class="mil-content-frame">
        <div class="mil-scroll mil-half-1 mil-bp-fix-2">
            
            <div class="mil-main-content" v-if="work">
                 <!-- Cover Logic similar to original -->
                 <div class="mil-work-card mil-no-descr mil-mb-15" v-if="work.image">
                    <a :href="work.image" data-fancybox="gallery" data-no-swup>
                        <img :src="work.image" :alt="work.title">
                    </a>
                </div>

                <div class="mil-project-description">
                    <div class="mil-space-90 mil-p-90-75">
                        <div class="row mil-mb-60 mil-up">
                            <div class="col-md-6">
                                <h1 class="mil-mb-30">{{ work.title }}</h1>
                            </div>
                            <div class="col-md-6 mil-jce mil-m-jcs mil-mb-30">
                                <div class="mil-badge mil-dark mil-mr-5" v-if="work.client">{{ work.client }}</div>
                                <div class="mil-badge">{{ work.category }}</div>
                            </div>
                        </div>

                        <!-- Markdown Content -->
                        <div class="mil-markdown-content mil-mb-60 mil-up" v-html="renderedBody" @click="handleLinkClick"></div>

                        <div class="mil-divider mil-mb-60 mil-up"></div>

                        <div class="row">
                            <div class="col-6 mil-up" v-if="work.client">
                                <div class="mil-link"><span class="mil-accent">client:</span> {{ work.client }}</div>
                            </div>
                            <div class="col-6 mil-jce mil-up" v-if="work.date">
                                <div class="mil-link"><span class="mil-accent">date:</span> {{ work.date }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
             <div v-else class="mil-p-90-75">
                <h1>Project not found</h1>
            </div>

             <div class="mil-bottom-panel">
                 <div class="mil-space-90 mil-jcb mil-w-100">
                     <div class="mil-jcb mil-w-100">
                         <!-- Previous Work -->
                        <div class="mil-prev-nav">
                             <router-link v-if="adjacentPosts.prev" :to="'/portfolio/' + adjacentPosts.prev.slug" class="mil-link mil-icon-link-left" title="Previous Project">
                                <i class="fas fa-chevron-left"></i> <span>Previous</span>
                             </router-link>
                             <span v-else class="mil-link mil-disabled" style="opacity: 0.5;"><i class="fas fa-chevron-left"></i> Previous</span>
                        </div>

                        <!-- Back to Listing -->
                        <router-link to="/portfolio" class="mil-link">Back to Portfolio</router-link>

                        <!-- Next Work -->
                        <div class="mil-next-nav">
                            <router-link v-if="adjacentPosts.next" :to="'/portfolio/' + adjacentPosts.next.slug" class="mil-link mil-icon-link" title="Next Project">
                                <span>Next</span> <i class="fas fa-chevron-right"></i>
                            </router-link>
                             <span v-else class="mil-link mil-disabled" style="opacity: 0.5;">Next <i class="fas fa-chevron-right"></i></span>
                        </div>
                     </div>
                 </div>
             </div>
        </div>
    </div>
</template>

<style>
/* Basic styles for markdown content */
.mil-markdown-content h1, 
.mil-markdown-content h2, 
.mil-markdown-content h3 {
    margin-bottom: 20px;
    margin-top: 30px;
}
.mil-markdown-content p {
    margin-bottom: 20px;
    line-height: 1.6;
}
.mil-markdown-content img {
    max-width: 100%;
    margin: 20px 0;
    border-radius: 5px;
}
.mil-markdown-content ul {
    margin-bottom: 20px;
    padding-left: 20px;
}
.mil-markdown-content li {
    list-style-type: disc;
    margin-bottom: 5px;
}
</style>
</file>

<file path="vite.config.js">
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import path from 'path'

// https://vite.dev/config/
export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
})
</file>

<file path="scripts/generate-rss.js">
import fs from 'fs';
import path from 'path';
import fm from 'front-matter';
import { fileURLToPath } from 'url';

// Configuration
const SITE_URL = 'https://couuas.github.io';
const SITE_TITLE = 'couuas.github.io';
const SITE_DESCRIPTION = 'Personal portfolio and blog of a creative designer/developer.';
const CONTENT_DIR = path.join(path.dirname(fileURLToPath(import.meta.url)), '../src/content/blog');
const PUBLIC_DIR = path.join(path.dirname(fileURLToPath(import.meta.url)), '../public');
const OUTPUT_FILE = path.join(PUBLIC_DIR, 'rss.xml');

// Recursive function to get all markdown files
function getFiles(dir) {
    let results = [];
    const list = fs.readdirSync(dir);
    list.forEach(file => {
        file = path.join(dir, file);
        const stat = fs.statSync(file);
        if (stat && stat.isDirectory()) {
            results = results.concat(getFiles(file));
        } else {
            if (file.endsWith('.md')) {
                results.push(file);
            }
        }
    });
    return results;
}

// Generate RSS Item
function generateItem(post) {
    return `
    <item>
        <title><![CDATA[${post.title}]]></title>
        <link>${SITE_URL}/blog/${post.slug}</link>
        <guid>${SITE_URL}/blog/${post.slug}</guid>
        <pubDate>${new Date(post.date).toUTCString()}</pubDate>
        <description><![CDATA[${post.description || ''}]]></description>
        <category>${post.category}</category>
    </item>`;
}

async function generateRSS() {
    console.log('Generating RSS feed...');

    const files = getFiles(CONTENT_DIR);
    const posts = [];

    files.forEach(filePath => {
        const content = fs.readFileSync(filePath, 'utf8');
        const parsed = fm(content);
        const attributes = parsed.attributes;

        // Logic to derive slug and category (Mirroring useMarkdown.js)
        const relativePath = path.relative(CONTENT_DIR, filePath); // e.g., 'Code/js.md' or 'post.md'
        const filename = path.basename(filePath, '.md');

        let category = attributes.category || 'General';

        // Start from folder name if available
        const pathParts = relativePath.split(path.sep);
        if (pathParts.length > 1) {
            const folderName = pathParts[0];
            // Simple capitalization
            category = folderName.charAt(0).toUpperCase() + folderName.slice(1);
        }

        posts.push({
            title: attributes.title,
            date: attributes.date ? new Date(attributes.date) : new Date(),
            description: attributes.description,
            category: category,
            slug: filename,
            image: attributes.image
        });
    });

    // Sort by date descending
    posts.sort((a, b) => b.date - a.date);

    const rssContent = `<?xml version="1.0" encoding="UTF-8" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
    <title>${SITE_TITLE}</title>
    <link>${SITE_URL}</link>
    <description>${SITE_DESCRIPTION}</description>
    <language>en-us</language>
    <lastBuildDate>${new Date().toUTCString()}</lastBuildDate>
    <atom:link href="${SITE_URL}/rss.xml" rel="self" type="application/rss+xml" />
    ${posts.map(generateItem).join('')}
</channel>
</rss>`;

    // Ensure public dir exists
    if (!fs.existsSync(PUBLIC_DIR)) {
        fs.mkdirSync(PUBLIC_DIR);
    }

    fs.writeFileSync(OUTPUT_FILE, rssContent);
    console.log(`RSS feed generated at ${OUTPUT_FILE}`);
}

generateRSS();
</file>

<file path="src/App.vue">
<script setup>
import MainLayout from './layouts/MainLayout.vue'
import TheAiAssistant from './components/TheAiAssistant.vue'
</script>

<template>
  <MainLayout />
  <TheAiAssistant />
</template>

<style>
/* Global styles are imported in main.js */

/* Initially hide scroll animation elements to prevent flash */
.mil-up {
    opacity: 0;
    pointer-events: none;
}
</style>
</file>

<file path="src/components/TheSidebar.vue">
<script setup>
import { RouterLink } from 'vue-router'
import { useAppStore } from '../stores/app'

const appStore = useAppStore()
</script>

<template>
  <div class="mil-menu-part">
    <router-link to="/" class="mil-logo">
      <!-- text logo -->
      <span>wa</span>
    </router-link>
    <div class="mil-menu-panel">
      <nav class="mil-main-menu" :class="{ 'mil-active': appStore.isMenuOpen }">
        <ul id="swupMenu">
          <router-link to="/" custom v-slot="{ href, navigate, isExactActive }">
            <li :class="{ 'mil-current': isExactActive }" @click="appStore.closeMenu">
              <a :href="href" @click="navigate" :class="{ 'mil-active': isExactActive }">
                <i class="fal fa-home"></i><span>Home</span>
              </a>
            </li>
          </router-link>
          
          <router-link to="/portfolio" custom v-slot="{ href, navigate, isActive }">
            <li :class="{ 'mil-current': isActive }" @click="appStore.closeMenu">
              <a :href="href" @click="navigate" :class="{ 'mil-active': isActive }">
                <i class="fal fa-palette"></i><span>Portfolio</span>
              </a>
            </li>
          </router-link>

          <router-link to="/blog" custom v-slot="{ href, navigate, isActive }">
            <li :class="{ 'mil-current': isActive }" @click="appStore.closeMenu">
              <a :href="href" @click="navigate" :class="{ 'mil-active': isActive }">
                <i class="fal fa-book"></i><span>Blog</span>
              </a>
            </li>
          </router-link>

          <router-link to="/friends" custom v-slot="{ href, navigate, isActive }">
            <li :class="{ 'mil-current': isActive }" @click="appStore.closeMenu">
              <a :href="href" @click="navigate" :class="{ 'mil-active': isActive }">
                <i class="fal fa-link"></i><span>Friends</span>
              </a>
            </li>
          </router-link>

          <router-link to="/contact" custom v-slot="{ href, navigate, isActive }">
            <li :class="{ 'mil-current': isActive }" @click="appStore.closeMenu">
              <a :href="href" @click="navigate" :class="{ 'mil-active': isActive }">
                <i class="fal fa-envelope"></i><span>Contact</span>
              </a>
            </li>
          </router-link>

          <li class="mil-sidebar-separator"></li>

          <router-link to="/galaxy" custom v-slot="{ href, navigate, isActive }">
            <li :class="{ 'mil-current': isActive }" @click="appStore.closeMenu" class="mil-lab-item">
              <a :href="href" @click="navigate" :class="{ 'mil-active': isActive }">
                <i class="fal fa-atom"></i><span>Galaxy</span>
                <sup class="mil-lab-badge">LAB</sup>
              </a>
            </li>
          </router-link>

        </ul>
      </nav>
      <div class="mil-menu-btn" :class="{ 'mil-active': appStore.isMenuOpen }" @click="appStore.toggleMenu"><span></span></div>
    </div>
  </div>
</template>

<style scoped>
/* Scoped styles if needed, otherwise global CSS handles it */
.mil-main-menu li a.mil-active {
    /* Ensure active state style matches .mil-current */
    color: #DBA91C; /* Example from style.css likely */
}
/* Just relies on global .mil-current style mostly, but we use .mil-active */

/* Lab Badge Styles */
.mil-lab-item a {
    position: relative;
    display: flex;
    align-items: center;
}

.mil-lab-badge {
    background: #DBA91C;
    color: #121212;
    font-size: 8px;
    font-weight: 900;
    padding: 1px 4px;
    border-radius: 4px;
    margin-left: 6px;
    line-height: 1;
    vertical-align: middle;
    letter-spacing: 0.5px;
    box-shadow: 0 2px 5px rgba(219, 169, 28, 0.3);
}

.mil-current .mil-lab-badge {
    background: #fff;
    color: #121212;
}

/* Separator */
.mil-sidebar-separator {
    border-top: dotted 2px #2C2C2C;
    margin: 15px 0;
    list-style: none;
    width: 60%;
    margin-left: auto;
    margin-right: auto;
}
</style>
</file>

<file path="src/layouts/MainLayout.vue">
<script setup>
import { onMounted, nextTick, onUnmounted, ref, computed, watch } from 'vue'
import { useRoute } from 'vue-router'
import TheSidebar from '../components/TheSidebar.vue'
import TheRightBar from '../components/TheRightBar.vue'
import { useAppStore } from '../stores/app'
import { useScrollAnimations } from '../composables/useScrollAnimations'
import { Fancybox } from "@fancyapps/ui"
import "@fancyapps/ui/dist/fancybox/fancybox.css"
import gsap from 'gsap'

const appStore = useAppStore()
const route = useRoute()
const { initAnimations, killAnimations } = useScrollAnimations()

// State for layout management
// We use a separate ref for body class to delay updates until AFTER the leave animation
const currentBodyClass = ref(route.meta.bodyClass)

// Determine if RightBar should be visible based on DELAYED route state (currentBodyClass)
// This prevents the sidebar from snapping before the page fades out
const shouldShowRightBar = computed(() => currentBodyClass.value !== 'mil-fw-page')

// Preloader state
const isLoading = ref(true)
const percent = ref(0)
const preloaderClass = ref('mil-preloader')

const setHeight = () => {
    const vh = window.innerHeight * 0.01
    document.documentElement.style.setProperty('--vh', `${vh}px`)
}

// Update the physical body class based on our reactive state
const applyBodyClass = () => {
  if (currentBodyClass.value) {
    document.body.className = currentBodyClass.value
  } else {
    document.body.className = ''
  }
}

onMounted(() => {
   setHeight()
   window.addEventListener('resize', setHeight)
   // Initial body class set
   currentBodyClass.value = route.meta.bodyClass
   applyBodyClass()

   Fancybox.bind("[data-fancybox]", {
      // Your custom options
   });
   
   // Preloader Animation
   const interval = setInterval(() => {
    if (percent.value < 100) {
      percent.value += 5 
    } else {
      clearInterval(interval)
      preloaderClass.value += ' mil-complete'
      
      // Init animations when preloader is done
      initAnimations()
      
      setTimeout(() => {
        isLoading.value = false
        appStore.setLoading(false)
      }, 800) 
    }
   }, 100) 
})

onUnmounted(() => {
    window.removeEventListener('resize', setHeight)
    Fancybox.destroy();
})

// --- Transition Hooks with GSAP ---

const onEnter = (el, done) => {
  // Set initial state
  gsap.set(el, {
    opacity: 0,
    y: 30, // Slight slide up effect
    filter: 'blur(10px)',
  })

  // Animate in
  gsap.to(el, {
    duration: 0.6,
    opacity: 1,
    y: 0,
    filter: 'blur(0px)',
    ease: 'power3.out',
    onComplete: () => {
      // Re-init scroll trigger animations after the element is settled
      initAnimations()
      done()
    }
  })
}

const onLeave = (el, done) => {
  // Kill old animations to prevent interference
  killAnimations()

  // Make leaving element absolute so it doesn't take up layout space
  // This allows the new element to occupy the correct position immediately (overlap)
  gsap.set(el, { 
    position: 'absolute', 
    width: '100%',
    top: 0,
    left: 0,
    zIndex: 0 
  })

  // Animate out
  gsap.to(el, {
    duration: 0.4,
    opacity: 0,
    y: -30, // Slide up while fading out
    filter: 'blur(10px)',
    ease: 'power3.in',
    onComplete: done
  })
}

const onAfterLeave = () => {
  // CRITICAL: Update the body class (and thus the layout) ONLY after the old page has left.
  // This happens in the "blank" state between pages.
  if (route.meta.bodyClass !== currentBodyClass.value) {
      currentBodyClass.value = route.meta.bodyClass
      applyBodyClass()
  }
  
  // Also ensuring scroll is reset if needed, though Vue Router usually handles this.
  // window.scrollTo(0, 0) 
}

</script>

<template>
  <div class="mil-frame-wrapper">
      <div :class="preloaderClass" v-if="isLoading">
          <div class="mil-preloader-content">
              <h1 class="mil-mb-30"><span class="mil-h3">Loading:</span> <span class="mil-accent mil-percent">{{ percent }}</span> <span class="mil-h3">%</span></h1>
              <div class="mil-preload-track">
                  <div class="mil-preload-line" :style="{ width: percent + '%' }"></div>
              </div>
          </div>
      </div>
    
    <div class="mil-frame">
      <TheSidebar />
      
      <div class="mil-content">
        <div class="mil-overlay" :class="{ 'mil-active': appStore.isMenuOpen }" @click="appStore.closeMenu"></div>
        
        <div class="mil-left-part">
          <router-view v-slot="{ Component }">
            <transition 
              mode="default" 
              :css="false" 
              @enter="onEnter" 
              @leave="onLeave" 
              @after-leave="onAfterLeave"
            >
              <component :is="Component" :key="route.path" />
            </transition>
          </router-view>
          
          <!-- Mobile RightBar (Visible only on mobile via CSS) -->
          <div class="mil-mobile-right-bar" :class="{ 'mil-hidden-trigger': !shouldShowRightBar }">
             <TheRightBar />
          </div>
        </div>
        
        <!-- Desktop RightBar -->
        <div class="mil-right-part" :class="{ 'mil-hidden-trigger': !shouldShowRightBar }">
           <TheRightBar />
        </div>
        
      </div>
    </div>
  </div>
</template>

<style scoped>
/* Mobile RightBar logic */
.mil-mobile-right-bar {
  display: block;
  margin-top: 30px;
  transition: all 0.8s ease; 
}


/* Trigger class to fade out sidebar when navigating to full-width page */
/* This now reacts to currentBodyClass, so it stays visible until afterLeave */
.mil-hidden-trigger {
    opacity: 0;
    transform: translateY(20px);
    filter: blur(5px);
    pointer-events: none;
    transition: all 0.4s ease; /* Faster exit for sidebar */
}

@media (min-width: 1200px) {
  .mil-mobile-right-bar {
    display: none;
  }
}

</style>
</file>

<file path="src/router/index.js">
import { createRouter, createWebHistory } from 'vue-router'
import Home from '../views/Home.vue'
import Portfolio from '../views/Portfolio.vue'
import PortfolioDetail from '../views/PortfolioDetail.vue'
import Blog from '../views/Blog.vue'
import Contact from '../views/Contact.vue'
import Friends from '../views/Friends.vue'

const router = createRouter({
    history: createWebHistory(import.meta.env.BASE_URL),
    routes: [
        {
            path: '/',
            name: 'home',
            component: Home,
            meta: { bodyClass: 'mil-fw-page' }
        },
        {
            path: '/portfolio',
            name: 'portfolio',
            component: Portfolio,
            meta: { bodyClass: 'mil-half-page' }
        },
        {
            path: '/portfolio/:id',
            name: 'portfolio-detail',
            component: PortfolioDetail,
            meta: { bodyClass: 'mil-half-page' }
        },
        {
            path: '/blog',
            name: 'blog',
            component: Blog,
            meta: { bodyClass: 'mil-half-page' }
        },
        {
            path: '/friends',
            name: 'friends',
            component: Friends,
            meta: { bodyClass: 'mil-half-page' }
        },
        {
            path: '/blog/:id',
            name: 'blog-detail',
            component: () => import('../views/BlogDetail.vue'),
            meta: { bodyClass: 'mil-fw-page' }
        },
        {
            path: '/contact',
            name: 'contact',
            component: Contact,
            meta: { bodyClass: 'mil-half-page' }
        },
        {
            path: '/galaxy',
            name: 'galaxy',
            component: () => import('../views/GalaxyPage.vue'),
            meta: { bodyClass: 'mil-fw-page' }
        }
    ],
    scrollBehavior(to, from, savedPosition) {
        return { top: 0 }
    }
})

// Set body class based on route meta
// Removed: Handling this in MainLayout to sync// Set body class based on route meta
router.beforeEach((to, from, next) => {
    // Body class handling is primarily done in MainLayout.vue transition hooks
    // to ensure smooth transitions. We only set it here if needed for initial load or as fallback.
    next()
})

export default router
</file>

<file path="src/stores/app.js">
import { defineStore } from 'pinia'
import { ref } from 'vue'

export const useAppStore = defineStore('app', () => {
    const isMenuOpen = ref(false)

    function toggleMenu() {
        isMenuOpen.value = !isMenuOpen.value
        // Toggle class on body or main wrapper if needed by CSS
        // The original template likely toggles a class on .mil-menu-btn or .mil-menu-part
        // We will handle this in components or here
    }

    function closeMenu() {
        isMenuOpen.value = false
    }

    const isLoading = ref(true)
    function setLoading(val) {
        isLoading.value = val
    }

    return { isMenuOpen, toggleMenu, closeMenu, isLoading, setLoading }
})
</file>

<file path="src/views/Blog.vue">
<script setup>
import { ref, computed, watch, nextTick } from 'vue'
import { RouterLink } from 'vue-router'
import { useMarkdown } from '@/composables/useMarkdown'
import { useScrollAnimations } from '@/composables/useScrollAnimations'

const { getPosts, getCategories } = useMarkdown()
const { initAnimations } = useScrollAnimations()

const allPosts = getPosts('blog')
const categories = getCategories('blog')

const activeCategory = ref('All')
const isExpanded = ref(false)

const filteredPosts = computed(() => {
    let posts = allPosts.value
    if (activeCategory.value !== 'All') {
        posts = posts.filter(p => p.category === activeCategory.value)
    }
    return posts
})

const displayedPosts = computed(() => {
    if (isExpanded.value) {
        return filteredPosts.value
    }
    return filteredPosts.value.slice(0, 6)
})

const showViewMore = computed(() => {
    return !isExpanded.value && filteredPosts.value.length > 6
})

const switchCategory = (cat) => {
    activeCategory.value = cat
    isExpanded.value = false // Reset expansion on category change
}

const switchToFullWidth = () => {
    isExpanded.value = true
    document.body.classList.remove('mil-half-page')
    document.body.classList.add('mil-fw-page')
}
// Watch for changes in displayed posts to trigger animations
watch(displayedPosts, async () => {
    await nextTick()
    initAnimations()
}, { deep: true })
</script>

<template>
    <div class="mil-content-frame mil-up">
        <div class="mil-scroll mil-half-1 mil-bp-fix">
            <div class="mil-row-fix">
                <div class="row">
                    <!-- Posts Loop -->
                    <div v-for="post in displayedPosts" :key="post.slug" class="col-lg-6">
                         <!-- Simplified Layout: Assuming col-lg-12 for full width list or col-lg-6 for grid. 
                              The original had a mix. Let's use a standard list card for Blog. -->
                        <div class="mil-blog-card mil-mb-15 mil-up">
                            <img :src="post.image" :alt="post.title" v-if="post.image">
                            <div class="mil-descr">
                                <div class="mil-post-text">
                                    <div class="mil-left">
                                        <h3 class="mil-line-height mil-mb-30">{{ post.title }}</h3>
                                        <router-link :to="'/blog/' + post.slug" class="mil-link mil-hover-link mil-accent">read more</router-link>
                                    </div>
                                    <div class="mil-right">
                                        <p>{{ post.description }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                   
                    <div v-if="filteredPosts.length === 0" class="col-12 mil-mb-15">
                        <p>No posts found in this category.</p>
                    </div>

                </div>
            </div>
            
            <a v-if="showViewMore" @click="switchToFullWidth" class="mil-btn mil-mb-15 cursor-pointer">View more posts</a>
            
            <div class="mil-bottom-panel">
                <div class="mil-jcc mil-w-100">
                    <div class="mil-filter">
                        <a v-for="cat in categories" :key="cat" 
                           @click.prevent="switchCategory(cat)"
                           href="#" 
                           :class="['mil-link', { 'mil-current': activeCategory === cat }]" 
                           data-no-swup>
                           {{ cat }}
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<style scoped>
.cursor-pointer {
    cursor: pointer;
}
</style>
</file>

<file path="src/views/Portfolio.vue">
<script setup>
import { ref, computed, watch, nextTick } from 'vue'
import { RouterLink } from 'vue-router'
import { useMarkdown } from '@/composables/useMarkdown'
import { useScrollAnimations } from '@/composables/useScrollAnimations'

const { getPosts, getCategories } = useMarkdown()
const { initAnimations } = useScrollAnimations()

const allWorks = getPosts('portfolio')
const categories = getCategories('portfolio')

const activeCategory = ref('All')
const isExpanded = ref(false)

const filteredWorks = computed(() => {
    let works = allWorks.value
    if (activeCategory.value !== 'All') {
        works = works.filter(p => p.category === activeCategory.value)
    }
    return works
})

const displayedWorks = computed(() => {
    if (isExpanded.value) {
        return filteredWorks.value
    }
    return filteredWorks.value.slice(0, 6)
})

const showViewMore = computed(() => {
    return !isExpanded.value && filteredWorks.value.length > 6
})

const switchCategory = (cat) => {
    activeCategory.value = cat
    isExpanded.value = false
}

const switchToFullWidth = () => {
    isExpanded.value = true
}

// Watch for changes in displayed works to trigger animations
watch(displayedWorks, async () => {
    await nextTick()
    initAnimations()
}, { deep: true })
</script>

<template>
    <div class="mil-content-frame mil-up">
        <div class="mil-scroll mil-bp-fix mil-half-1">
            <div class="mil-row-fix">
                <div class="row">
                    <div v-for="work in displayedWorks" :key="work.slug" class="col-lg-6">
                        <div class="mil-blog-card mil-sm mil-mb-15 mil-up">
                            <img :src="work.image" :alt="work.title" v-if="work.image">
                            <div class="mil-descr">
                                <div class="mil-post-text">
                                    <div class="mil-left">
                                        <h3 class="mil-line-height mil-mb-20">{{ work.title }}</h3>
                                        <router-link :to="'/portfolio/' + work.slug" class="mil-link mil-hover-link mil-accent">read more</router-link>
                                    </div>
                                    <div class="mil-right">
                                        <p>{{ work.description }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div v-if="filteredWorks.length === 0" class="col-12 mil-mb-15">
                        <p>No projects found in this category.</p>
                    </div>
                </div>
            </div>

            <a v-if="showViewMore" @click="switchToFullWidth" class="mil-btn mil-mb-15 cursor-pointer">View more projects</a>
            
            <div class="mil-bottom-panel">
                <div class="mil-jcc mil-w-100">
                    <div class="mil-filter">
                         <a v-for="cat in categories" :key="cat" 
                           @click.prevent="switchCategory(cat)"
                           href="#" 
                           :class="['mil-link', { 'mil-current': activeCategory === cat }]" 
                           data-no-swup>
                           {{ cat }}
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<style scoped>
.cursor-pointer {
    cursor: pointer;
}
</style>
</file>

<file path="package.json">
{
  "name": "wasker_vue",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "npm run generate:graph && vite",
    "build": "npm run generate:graph && npm run generate:rss && vite build",
    "generate:rss": "node scripts/generate-rss.js",
    "generate:graph": "node scripts/generate-graph.js",
    "preview": "vite preview"
  },
  "dependencies": {
    "@fancyapps/ui": "^6.1.7",
    "3d-force-graph": "^1.79.0",
    "dotenv": "^17.2.3",
    "front-matter": "^4.0.2",
    "gsap": "^3.14.2",
    "highlight.js": "^11.11.1",
    "imagesloaded": "^5.0.0",
    "markdown-it": "^14.1.0",
    "pinia": "^3.0.4",
    "sass": "^1.97.0",
    "swiper": "^12.0.3",
    "three": "^0.182.0",
    "vue": "^3.5.24",
    "vue-router": "^4.6.4"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^6.0.1",
    "glob": "^13.0.0",
    "gray-matter": "^4.0.3",
    "vite": "^7.2.4"
  }
}
</file>

</files>
